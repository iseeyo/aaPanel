var bt_file={area:[],loadT:null,loadY:null,vscode:null,file_table_arry:[],timerM:null,is_update_down_list:!0,is_recycle:!1,is_editor:!1,file_header:{file_checkbox:40,file_name:"auto",file_accept:130,file_size:90,file_mtime:155,file_ps:"auto",file_operation:350,file_tr:0,file_list_header:0},file_operating:[],file_pointer:-1,file_path:"C:/",file_page_num:bt.get_storage("local","showRow")||100,file_list:[],file_store_list:[],file_store_current:0,file_images_list:[],file_drop:null,file_present_task:null,file_selection_operating:[],file_share_list:[],scroll_width:function(){var e,t,i=document.createElement("DIV");return i.style.cssText="position:absolute; top:-1000px; width:100px; height:100px; overflow:hidden;",e=document.body.appendChild(i).clientWidth,i.style.overflowY="scroll",t=i.clientWidth,document.body.removeChild(i),e-t}(),is_mobile:function(){return!(!navigator.userAgent.match(/mobile/i)&&!/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent))&&(layer.msg(navigator.userAgent.match(/mobile/i),{icon:2,time:0}),!0)},method_list:{GetFileBody:lan.public.get_file_contents,DeleteDir:lan.public.deleting,DeleteFile:lan.public.deleting,GetDiskInfo:["system",lan.public.getting_disk_list],CheckExistsFiles:lan.files.check_same_name_file,GetFileAccess:lan.files.getting_permission_list,SetFileAccess:lan.public.config,DelFileAccess:lan.files.deleting_user,get_path_size:lan.files.getting_dir_size,add_files_store_types:lan.files.create_favorite,get_files_store:lan.files.getting_favorite,del_files_store:lan.files.unfavorite,dir_webshell_check:"目录查杀",file_webshell_check:"查杀文件",get_download_url_list:lan.files.getting_share_list,get_download_url_find:lan.files.getting_s_share_info,create_download_url:lan.files.create_share,remove_download_url:lan.files.cancel_share,add_files_store:lan.files.adding_favorite,CopyFile:lan.files.copy_the,MvFile:lan.files.mv_the,SetBatchData:lan.files.performing_bulk_opt,Get_Recycle_bin:lan.files.getting_recycle_list,get_path_premissions:lan.files.getting_permission_list,back_path_permissions:lan.files.setting_permission_list,get_all_back:lan.files.getting_permission_list,fix_permissions:lan.files.fix_permission,del_path_premissions:lan.files.deleting_permission},file_drop:{f_path:null,startTime:0,endTime:0,uploadLength:0,splitSize:2097152,splitEndTime:0,splitStartTime:0,fileSize:0,speedLastTime:0,filesList:[],errorLength:0,isUpload:!0,uploadSuspend:[],isUploadNumber:800,uploadAllSize:0,uploadedSize:0,updateedSizeLast:0,topUploadedSize:0,uploadExpectTime:0,initTimer:0,speedInterval:null,timerSpeed:0,isLayuiDrop:!1,uploading:!1,is_webkit:navigator.userAgent.indexOf("WebKit")>-1,init:function(){0==$("#mask_layer").length&&(window.UploadFiles=function(){bt_file.file_drop.dialog_view()},$("body").append($('<div class="mask_layer" id="mask_layer" style="position:fixed;top:0;left:0;right:0;bottom:0; background:rgba(255,255,255,0.6);border:3px #ccc dashed;z-index:99999999;display:none;color:#999;font-size:40px;text-align:center;overflow:hidden;"><span style="position: absolute;top: 50%;left: 50%;margin-left: -300px;margin-top: -40px;">Upload files to the current directory'+(this.is_webkit?"":'<i style="font-size:20px;font-style:normal;display:block;margin-top:15px;color:red;">The current browser does not support drag upload. Commend to use Chrome browser or WebKit kernel for browsing</i>')+"</span></div>")),this.event_relation(document.querySelector("#container"),document,document.querySelector("#mask_layer")))},event_relation:function(e,t,i){var a=this;Object.keys(arguments);for(var l in arguments)"object"==typeof arguments[l]&&void 0!==arguments[l].nodeType&&(arguments[l]={el:arguments[l],callback:null});t.el.addEventListener("dragleave",null!=t.callback?t.callback:function(e){0==e.x&&0==e.y&&$("#mask_layer").hide(),e.preventDefault()},!1),e.el.addEventListener("dragenter",null!=e.callback?e.callback:function(e){if("string"==e.dataTransfer.items[0].kind)return!1;$("#mask_layer").show(),a.isLayuiDrop=!1,e.preventDefault()},!1),i.el.addEventListener("dragover",function(e){e.preventDefault()},!1),i.el.addEventListener("drop",null!=e.callback?i.callback:a.ev_drop,!1)},ev_drop:function(e){function t(e){e.getFilesAndDirectories().then(function(t){return n(t,e.path)})}if("string"==e.dataTransfer.items[0].kind)return!1;if(!bt_file.file_drop.is_webkit)return $("#mask_layer").hide(),!1;if(e.preventDefault(),bt_file.file_drop.uploading)return layer.msg("Uploading files, please wait..."),!1;var i,a=e.dataTransfer.items,l=0;if(loadT=layer.msg("Getting upload files details, please wait...",{icon:16,time:0,shade:.3}),bt_file.file_drop.isUpload=!0,a&&a.length&&null!=a[0].webkitGetAsEntry&&"file"!=a[0].kind)return!1;null==bt_file.file_drop.filesList&&(bt_file.file_drop.filesList=[]);for(var s=bt_file.file_drop.filesList.length-1;s>=0;s--)bt_file.file_drop.filesList[s].is_upload&&bt_file.file_drop.filesList.splice(-s,1);$("#mask_layer").hide();var n=function(e,a){if(!bt_file.file_drop.isUpload)return!1;for(var s=0;s<e.length;s++)if("function"==typeof e[s].getFilesAndDirectories)t(e[s]);else{if(l>bt_file.file_drop.isUploadNumber)return bt_file.file_drop.isUpload=!1,layer.msg(" "+bt_file.file_drop.isUploadNumber+" items cannot upload, please compress first!。",{icon:2,area:"405px"}),bt_file.file_drop.filesList=[],clearTimeout(i),!1;bt_file.file_drop.filesList.push({file:e[s],path:bt.get_file_path(a+"/"+e[s].name).replace("//","/"),name:e[s].name.replace("//","/"),icon:bt_file.get_ext_name(e[s].name),size:bt_file.file_drop.to_size(e[s].size),upload:0,is_upload:!1}),bt_file.file_drop.uploadAllSize+=e[s].size,clearTimeout(i),i=setTimeout(function(){layer.close(loadT),bt_file.file_drop.dialog_view()},100),l++}};"getFilesAndDirectories"in e.dataTransfer&&e.dataTransfer.getFilesAndDirectories().then(function(e){return n(e,"/")})},dialog_view:function(e){var t=this,i="";if(this.f_path=bt_file.file_path,!$(".file_dir_uploads").length>0){null==t.filesList&&(t.filesList=[]);for(var a=0;a<t.filesList.length;a++){var l=t.filesList[a];i+='<li><div class="fileItem"><span class="filename" title="File path:'+(l.path+"/"+l.name).replace("//","/")+"&#10;File type:"+l.file.type+"&#10;File size:"+l.size+'"><i class="ico ico-'+l.icon+'"></i>'+(l.path+"/"+l.name).replace("//","/")+'</span><span class="filesize">'+l.size+'</span><span class="fileStatus">'+t.is_upload_status(l.upload)+'</span></div><div class="fileLoading"></div></li>'}var s=t.filesList.length>11;layer.open({type:1,closeBtn:1,maxmin:!0,area:["550px","505px"],btn:["Upload","Cancel","Clear"],title:"Upload files to【"+bt.get_cookie("Path")+"】--- Support breakpoint renewal",skin:"file_dir_uploads",content:'<div style="padding:15px 15px 10px 15px;"><div class="upload_btn_groud"><div class="btn-group"><button type="button" class="btn btn-primary btn-sm upload_file_btn">Upload file</button><button type="button" class="btn btn-primary  btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button><ul class="dropdown-menu"><li><a href="#" data-type="file">Upload file</a></li><li><a href="#" data-type="dir">Upload path</a></li></ul></div><div class="file_upload_info" style="display:none;"><span>Total process&nbsp;<i class="uploadProgress"></i>, uploading&nbsp;<i class="uploadNumber"></i>,</span><span style="display:none">Upload fail&nbsp;<i class="uploadError"></i></span><span>Speed&nbsp;<i class="uploadSpeed">Getting</i>,</span><span>Expect time&nbsp;<i class="uploadEstimate">Getting</i></span><i></i></div></div><div class="upload_file_body '+(""==i?"active":"")+'">'+(""!=i?'<ul class="dropUpLoadFileHead" style="padding-right:'+(s?"15":"0")+'px"><li class="fileTitle"><span class="filename">File name</span><span class="filesize">File size</span><span class="fileStatus">File status</span></li></ul><ul class="dropUpLoadFile list-list">'+i+"</ul>":"<span>Please drag the file here"+(t.is_webkit?"":'<i style="display: block;font-style: normal;margin-top: 10px;color: red;font-size: 17px;">The current browser does not support drag upload. Commend to use Chrome browser or WebKit kernel for browsing</i>')+"</span>")+"</div></div>",success:function(layers){layers.find('.layui-layer-btn2').css('margin','0 300px 0 0');$("#mask_layer").hide(),$(".file_dir_uploads .layui-layer-max").hide(),$(".upload_btn_groud .upload_file_btn").click(function(){$(".upload_btn_groud .dropdown-menu [data-type=file]").click()}),$(".upload_btn_groud .dropdown-menu a").click(function(){var e=$(this).attr("data-type");$('<input type="file" multiple="true" autocomplete="off" '+("dir"==e?'webkitdirectory=""':"")+" />").change(function(e){for(var i=e.target.files,a=0;a<i.length;a++){var l={file:i[a],path:bt.get_file_path("/"+i[a].webkitRelativePath).replace("//","/"),icon:bt_file.get_ext_name(i[a].name),name:i[a].name.replace("//","/"),size:t.to_size(i[a].size),upload:0,is_upload:!0};t.filesList.push(l),bt_file.file_drop.uploadAllSize+=i[a].size}t.dialog_view(t.filesList)}).click()});t.event_relation({el:$(".upload_file_body")[0],callback:function(e){$(this).hasClass("active")&&$(this).css("borderColor","#4592f0").find("span").css("color","#4592f0")}},{el:$(".upload_file_body")[0],callback:function(e){$(this).hasClass("active")&&$(this).removeAttr("style").find("span").removeAttr("style")}},{el:$(".upload_file_body")[0],callback:function(e){var i=$(".upload_file_body");i.hasClass("active")&&i.removeAttr("style").find("span").removeAttr("style"),t.ev_drop(e),t.isLayuiDrop=!0}})},yes:function(e,i){if(!t.uploading){if(0==t.filesList.length)return layer.msg("Please select file",{icon:0}),!1;$(".layui-layer-btn0").css({cursor:"no-drop",background:"#5c9e69"}).attr("data-upload","true").text("Uploading"),t.upload_file(),t.initTimer=new Date,t.uploading=!0}},btn2:function(e,i){if(t.uploading)return layer.confirm("Do you want to cancel the upload of files? It need to delete the uploaded files manually. Continue?",{title:"Cancel file upload",icon:0},function(t){layer.close(e),layer.close(t)}),!1;layer.close(e)},btn3:function(e,i){if(t.uploading){layer.confirm("Do you want to cancel the upload of files? It need to delete the uploaded files manually. Continue?",{title:"Cancel file upload",icon:0},function(t){$('.upload_file_body').addClass('active').html('<span>Please drag the file here</span>')});t.filesList.length=0;return !1;}else{$('.upload_file_body').addClass('active').html('<span>Please drag the file here</span>');t.filesList.length=0;return !1;}},end:function(){t.clear_drop_stauts(!0)},min:function(){$(".file_dir_uploads .layui-layer-max").show(),$("#layui-layer-shade"+$(".file_dir_uploads").attr("times")).fadeOut()},restore:function(){$(".file_dir_uploads .layui-layer-max").hide(),$("#layui-layer-shade"+$(".file_dir_uploads").attr("times")).fadeIn()}})}else{if(null==e&&!t.isLayuiDrop)return!1;if(t.isLayuiDrop&&(e=t.filesList),$(".upload_file_body").html('<ul class="dropUpLoadFileHead" style="padding-right:'+(e.length>11?"15":"0")+'px"><li class="fileTitle"><span class="filename">File name</span><span class="filesize">File size</span><span class="fileStatus">File status</span></li></ul><ul class="dropUpLoadFile list-list"></ul>').removeClass("active"),Array.isArray(e)){for(a=0;a<e.length;a++){l=e[a];i+='<li><div class="fileItem"><span class="filename" title="File path:'+l.path+"/"+l.name+"&#10;File type:"+l.file.type+"&#10;Size:"+l.size+'"><i class="ico ico-'+l.icon+'"></i>'+(l.path+"/"+l.name).replace("//","/")+'</span><span class="filesize">'+l.size+'</span><span class="fileStatus">'+t.is_upload_status(l.upload)+'</span></div><div class="fileLoading"></div></li>'}$(".dropUpLoadFile").append(i)}else $(".dropUpLoadFile").append('<li><div class="fileItem"><span class="filename" title="File path:'+(e.path+"/"+e.name).replace("//","/")+"&#10;File type:"+e.type+"&#10;Size:"+e.size+'"><i class="ico ico-'+e.icon+'"></i>'+(e.path+"/"+e.name).replace("//","/")+'</span><span class="filesize">'+e.size+'</span><span class="fileStatus">'+t.is_upload_status(e.upload)+'</span></div><div class="fileLoading"></div></li>')}},is_upload_status:function(e,t){switch(void 0===t&&(t=""),e){case-1:return'<span class="upload_info upload_error" title="Fail'+(""!=t?","+t:"")+'">Fail'+(""!=t?","+t:"")+"</span>";case 0:return'<span class="upload_info upload_primary">Waiting to upload</span>';case 1:return'<span class="upload_info upload_success">Uploaded</span>';case 2:return'<span class="upload_info upload_warning">Uploading '+t+"</span>";case 3:return'<span class="upload_info upload_success">Stoped</span>'}},set_upload_view:function(e,t){var i=$(".dropUpLoadFile li:eq("+e+")"),a=this,l=$(".file_upload_info");0==$(".file_upload_info .uploadProgress").length&&$(".file_upload_info").html('<span>Total process&nbsp;<i class="uploadProgress"></i>,Uploading&nbsp;<i class="uploadNumber"></i>,</span><span style="display:none">Fail&nbsp;<i class="uploadError"></i></span><span>Speed&nbsp;<i class="uploadSpeed">Getting</i>,</span><span>Expect time&nbsp;<i class="uploadEstimate">Getting</i></span><i></i>'),l.show().prev().hide().parent().css("paddingRight",0),a.errorLength>0&&l.find(".uploadError").text("("+a.errorLength+"份)").parent().show(),l.find(".uploadNumber").html("("+a.uploadLength+"/"+a.filesList.length+")"),l.find(".uploadProgress").html((a.uploadedSize/a.uploadAllSize*100).toFixed(2)+"%"),1===t.upload||-1===t.upload?(a.filesList[e].is_upload=!0,a.uploadLength+=1,i.find(".fileLoading").css({width:"100%",opacity:".5",background:-1==t.upload?"#ffadad":"#20a53a21"}),i.find(".filesize").text(t.size),i.find(".fileStatus").html(a.is_upload_status(t.upload,1===t.upload?"(Time:"+a.diff_time(a.startTime,a.endTime)+")":t.errorMsg)),i.find(".fileLoading").fadeOut(500,function(){$(this).remove();var e=$(".dropUpLoadFile");if(0==e.length)return!1;e[0].scrollHeight>e.height()&&e.scrollTop(e.scrollTop()+40)})):(i.find(".fileLoading").css("width",t.percent),i.find(".filesize").text(t.upload_size+"/"+t.size),i.find(".fileStatus").html(a.is_upload_status(t.upload,"("+t.percent+")")))},clear_drop_stauts:function(e){var t=new Date,i=this;if(!e)try{var a=bt_file.file_drop.to_size(bt_file.file_drop.uploadedSize/((t.getTime()-bt_file.file_drop.initTimer.getTime())/1e3));$(".file_upload_info").html("<span>"+this.uploadLength+" uploaded,"+(this.errorLength>0?this.errorLength+"failures, ":"")+"time"+this.diff_time(this.initTimer,t)+",speed "+a+"/s</span>").append($('<i class="ico-tips-close"></i>').click(function(){$(".file_upload_info").hide().prev().show()}))}catch(e){}$(".layui-layer-btn0").removeAttr("style data-upload").text(lan.upload.upload),$.extend(bt_file.file_drop,{startTime:0,endTime:0,uploadLength:0,splitSize:2097152,filesList:[],errorLength:0,isUpload:!1,isUploadNumber:800,uploadAllSize:0,uploadedSize:0,topUploadedSize:0,uploadExpectTime:0,initTimer:0,speedInterval:null,timerSpeed:0,uploading:!1}),clearInterval(i.speedInterval)},upload_file:function(e,t){if(null==e&&0==this.uploadSuspend.length&&(e=0,t=0),this.filesList.length===t)return clearInterval(this.speedInterval),this.clear_drop_stauts(),bt_file.reader_file_list({path:bt_file.file_path,is_operating:!1}),!1;var i=this;i.splitEndTime=(new Date).getTime(),i.get_timer_speed(),i.splitStartTime=(new Date).getTime();var a=this.filesList[t],l="";if(null==a)return!1;l=Math.min(a.file.size,e+this.splitSize),i.fileSize=l-e,form=new FormData,0==e&&(i.startTime=new Date,a=$.extend(a,{percent:"0%",upload:2,upload_size:"0B"})),form.append("f_path",this.f_path+a.path),form.append("f_name",a.name),form.append("f_size",a.file.size),form.append("f_start",e),form.append("blob",a.file.slice(e,l)),i.set_upload_view(t,a),$.ajax({url:"/files?action=upload",type:"POST",data:form,async:!0,processData:!1,contentType:!1,success:function(s){"number"==typeof s?(i.set_upload_view(t,$.extend(a,{percent:(s/a.file.size*100).toFixed(2)+"%",upload:2,upload_size:i.to_size(s)})),i.uploadedSize+=l!=s?s:parseInt(l-e),i.upload_file(s,t)):s.status?(i.endTime=new Date,i.uploadedSize+=parseInt(l-e),i.set_upload_view(t,$.extend(a,{upload:1,upload_size:a.size})),i.upload_file(0,t+=1)):(i.set_upload_view(t,$.extend(a,{upload:-1,errorMsg:s.msg})),i.errorLength++)},error:function(a){if(void 0===i.filesList[t].req_error&&(i.filesList[t].req_error=1),i.filesList[t].req_error>2)return i.set_upload_view(t,$.extend(i.filesList[t],{upload:-1,errorMsg:"error"==a.statusText?lan.public.network_err:a.statusText})),i.errorLength++,i.upload_file(e,t+=1),!1;i.filesList[t].req_error+=1,i.upload_file(e,t)}})},get_timer_speed:function(e){var t=(new Date).getTime();if(t-this.speedLastTime>1e3){var i=this;null==e&&(e=200);var a=(i.splitEndTime-i.splitStartTime)/1e3;if(i.timerSpeed=(i.fileSize/a).toFixed(2),i.updateedSizeLast=i.uploadedSize,i.timerSpeed<2)return;$(".file_upload_info .uploadSpeed").text(i.to_size(isNaN(i.timerSpeed)?0:i.timerSpeed)+"/s");var l=i.time(parseInt((i.uploadAllSize-i.uploadedSize)/i.timerSpeed*1e3));isNaN(i.timerSpeed)||$(".file_upload_info .uploadEstimate").text(-1==l.indexOf("NaN")?l:"0 "+lan.bt.s),this.speedLastTime=t}},time:function(e){var t=Math.floor(e/36e5),i=Math.floor(e/6e4),a=parseInt(e%6e4/1e3),l=a+"sec";return i>0&&(l=i+"min"+a+"sec"),t>0&&(l=t+"hour"+Math.floor((e-36e5*t)/6e4)+"min"),l},diff_time:function(e,t){var i=t.getTime()-e.getTime(),a=Math.floor(i/6e4),l=i%6e4,s=l/1e3,n=s.toFixed(a>0?0:2)+lan.bt.s;return a>0&&(n=a+"min"+s.toFixed(0)+lan.bt.s),n},to_size:function(e){for(var t=[" B"," KB"," MB"," GB"," TB"," PB"],i=1024,a=0;a<t.length;a+=1){if(e<i){var l=(0===a?e:e.toFixed(2))+t[a];return isNaN(0===a?e:e.toFixed(2))||void 0===l?"0B":l}e/=i}}},init:function(){null!=bt.get_cookie("rank")&&null!=bt.get_cookie("rank")&&"a"!=bt.get_cookie("rank")&&"b"!=bt.get_cookie("rank")||bt.set_cookie("rank","list"),this.area=[window.innerWidth,window.innerHeight],this.file_path=bt.get_cookie("Path"),this.event_bind(),this.reader_file_list({is_operating:!0}),this.render_file_disk_list(),this.file_drop.init(),this.set_file_table_width()},event_bind:function(){var e=this;$(window).resize(function(t){$(this)[0].innerHeight!=e.area[1]&&(e.area[1]=$(this)[0].innerHeight,e.set_file_view()),$(this)[0].innerWidth!=e.area[0]&&(e.area[0]=$(this)[0].innerWidth,e.set_dir_view_resize(),e.set_menu_line_view_resize(),e.set_file_table_width())}).keydown(function(t){t=window.event||t;var i=t.keyCode,a=t.target.tagName.toLowerCase();e.is_editor||(t.ctrlKey&&86==i&&"input"!=a&&"textarea"!=a&&e.paste_file_or_dir(),8==i&&"input"!==a&&"textarea"!==a&&void 0===$(t.target).attr("data-backspace")&&$(".file_path_upper").click())}),$(".search_path_views").find(".file_search_checked").unbind("click").click(function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active")}),$(".search_path_views").on("click",".path_btn",function(t){var i={path:e.file_path,search:$(".file_search_input").val()};$("#search_all").hasClass("active")&&(i.all="True"),e.loadT=bt.load("Searching file, please wait..."),e.reader_file_list(i,function(t){t.msg||e.loadT.close()}),$(".file_search_config").addClass("hide"),t.stopPropagation()}),$(".search_path_views").on("click",".file_search_config label",function(e){$(this).prev().click()}),$(".search_path_views .file_search_input").on("focus keyup",function(t){t=t||window.event;var i={path:e.file_path,search:$(this).val()};switch(t.type){case"keyup":var a=$(".file_search_checked").hasClass("active");if(a&&(i.all="True"),13!=t.keyCode&&"keyup"==t.type)return!1;e.loadT=bt.load("Searching file, please wait..."),e.reader_file_list(i,function(t){t.msg||e.loadT.close()})}t.stopPropagation(),t.preventDefault()}),$(".file_path_input .path_input").on("focus blur keyup",function(t){t=t||window.event;var i=$(this).attr("data-path"),a=$(this);switch(t.type){case"focus":$(this).addClass("focus").val(i).prev().hide();break;case"blur":$(this).removeClass("focus").val("").prev().show();break;case"keyup":if(13!=t.keyCode&&"keyup"==t.type)return!1;$(this).data("path")!=$(this).val()&&e.reader_file_list({path:e.path_check($(this).val()),is_operating:!0},function(t){!1===t.status?a.val(i):(a.val(e.path_check(t.PATH)),a.blur().prev().show())})}t.stopPropagation()}),$(".file_path_input .file_dir_view").on("click",".file_dir",function(){e.reader_file_list({path:$(this).attr("title"),is_operating:!0})}),$(".forward_path span").click(function(){var t=$(this).index(),i="";if(!$(this).hasClass("active")){switch(t){case 0:e.file_pointer=e.file_pointer-1,i=e.file_operating[e.file_pointer];break;case 1:e.file_pointer=e.file_pointer+1,i=e.file_operating[e.file_pointer]}e.reader_file_list({path:i,is_operating:!1})}}),$(".file_path_input .file_dir_view").on("click",".file_dir_omit",function(e){var t=this,i=$(this).children(".nav_down_list");$(this).addClass("active"),i.addClass("show"),$(document).one("click",function(){$(t).removeClass("active"),i.removeClass("show"),e.stopPropagation()}),e.stopPropagation()}),$(".file_path_input .file_dir_view").on("click",".file_dir_item i",function(t){var i=$(this).siblings(".nav_down_list"),a=$(this).siblings("span").attr("title");i.show().parent().siblings().find(".nav_down_list").removeAttr("style"),e.render_path_down_list(i,a),$(document).one("click",function(){i.removeAttr("style"),t.stopPropagation()}),t.stopPropagation()}),$(".file_path_input .file_dir_view").on("click",".file_dir_item .nav_down_list li",function(t){e.reader_file_list({path:$(this).data("path"),is_operating:!0})}),$(".file_path_upper").click(function(){e.reader_file_list({path:e.retrun_prev_path(e.file_path),is_operating:!0})}),$(".file_path_refresh").click(function(){e.reader_file_list({path:e.file_path},function(e){e.msg||layer.msg("Refresh succeeded")})}),$(".upload_file").on("click",function(t){e.file_drop.dialog_view()}),$(".upload_download").on("click",function(t){e.open_download_view()}),$(".file_nav_view .create_file_or_dir li").on("click",function(t){if($(this).index()>1)return e.file_groud_event({open:"soft_link"}),!1;var i=$(this).data("type"),a=$(".create_file_or_dir .nav_down_list");if(a.css({display:function(){return setTimeout(function(){a.removeAttr("style")},100),"none"}}),e.is_editor)return!1;e.is_editor=!0,$(".file_list_content").prepend('<div class="file_tr createModel active"><div class="file_td file_checkbox"></div><div class="file_td file_name"><div class="file_ico_type"><i class="file_icon '+("newBlankDir"==i?"file_folder":"")+'"></i></div>'+("icon"==bt.get_cookie("rank")?'<span class="file_title file_'+("newBlankDir"==i?"dir":"file")+'_status"><textarea name="createArea" onfocus="select()">'+("newBlankDir"==i?"New directory":"New blank file")+"</textarea></span>":'<span class="file_title file_'+("newBlankDir"==i?"dir":"file")+'_status"><input name="createArea" value="'+("newBlankDir"==i?"New directory":"New blank file")+'" onfocus="select()" type="text"></span>')+"</div></div>"),$(("icon"==bt.get_cookie("rank")?"textarea":"input")+"[name=createArea]").on("input",function(){"icon"==bt.get_cookie("rank")&&(this.style.height="auto",this.style.height=this.scrollHeight+"px")}).keyup(function(e){13==e.keyCode&&$(this).blur()}).blur(function(t){var a=$(this).val().replace(/[\r\n]/g,"");if(e.match_unqualified_string(a))return layer.msg('Name cannot contain /\\:*?"<>| symbol',{icon:2});""==a&&(a="newBlankDir"==i?"New directory":"New blank file"),setTimeout(function(){e.create_file_req({type:"newBlankDir"==i?"folder":"file",path:e.file_path+"/"+a},function(t){t.status&&e.reader_file_list({path:e.file_path}),layer.msg(t.msg,{icon:t.status?1:2})}),$(".createModel").remove(),e.is_editor=!1},300),t.preventDefault()}).focus(),t.stopPropagation(),t.preventDefault()}),$(".file_nav_view .favorites_file_path ul").on("click","li",function(t){var i=$(this).data("path"),a=$(this).data("type"),l=$(".favorites_file_path .nav_down_list");if("dir"==a)e.reader_file_list({path:i,is_operating:!0});else{if(null!=$(this).data("null"))return!1;var s=$(this).attr("title").split("."),n=s[s.length-1],o=e.determine_file_type(n);switch(o){case"text":openEditorView(0,i);break;case"video":e.open_video_play(i);break;case"images":e.open_images_preview({filename:$(this).attr("title"),path:i});break;default:e.reader_file_list({path:e.retrun_prev_path(i),is_operating:!0})}}l.css({display:function(){return setTimeout(function(){l.removeAttr("style")},100),"none"}}),t.stopPropagation(),t.preventDefault()}),$(".terminal_view").on("click",function(){web_shell()}),$(".share_file_list").on("click",function(){e.open_share_view()}),$(".mount_disk_list").on("click",".nav_btn",function(){var t=$(this).data("menu");e.reader_file_list({path:t,is_operating:!0})}),$(".mount_disk_list").on("click",".nav_down_list li",function(){var t=$(this).data("disk"),i=$(".mount_disk_list.thezoom .nav_down_list");i.css({display:function(){return setTimeout(function(){i.removeAttr("style")},100),"none"}}),e.reader_file_list({path:t,is_operating:!0})}),$(".file_nav_view").on("click",".manage_backup",function(t){e.manage_backup(),t.stopPropagation(),t.preventDefault()}),$(".file_nav_view").on("click",".recycle_bin",function(t){e.recycle_bin_view(),t.stopPropagation(),t.preventDefault()}),$(".file_nav_view .multi").on("click",".nav_btn_group",function(t){var i=$(this).data("type");void 0!==i&&e.batch_file_manage(i),t.stopPropagation(),t.preventDefault()}),$(".file_nav_view .multi").on("click",".nav_btn_group li",function(t){var i=$(this).data("type");e.batch_file_manage(i),t.stopPropagation(),t.preventDefault()}),$(".file_nav_view").on("click",".file_all_paste",function(){e.paste_file_or_dir()}),$(".file_list_header").on("click",".file_name,.file_size,.file_mtime,.file_accept,.file_user",function(t){var i=$(this).attr("data-tid"),a=$(this).find(".icon_sort").hasClass("active"),l=$(this).hasClass("active");return!$(this).find(".icon_sort").hasClass("active")&&$(this).hasClass("active")?$(this).find(".icon_sort").addClass("active"):$(this).find(".icon_sort").removeClass("active"),$(this).addClass("active").siblings().removeClass("active").find(".icon_sort").removeClass("active").empty(),$(this).find(".icon_sort").html('<i class="iconfont icon-xiala"></i>'),l||(a=!0),bt.set_cookie("files_sort",i),bt.set_cookie("name_reverse",a?"True":"False"),e.reader_file_list({reverse:a?"True":"False",sort:i}),!1}),$(".file_list_header .file_th").each(function(e,t){var i=bt.get_cookie("files_sort"),a=bt.get_cookie("name_reverse");$(this).attr("data-tid")===i&&($(this).addClass("active").siblings().removeClass("active").find(".icon_sort").removeClass("active").empty(),$(this).find(".icon_sort").html('<i class="iconfont icon-xiala"></i>'),"False"===a&&$(this).find(".icon_sort").addClass("active"))}),$(".file_list_header .file_check").on("click",function(t){var i=parseInt($(this).data("checkbox"));switch(i){case 0:$(this).addClass("active").removeClass("active_2").data("checkbox",1),$(".file_list_content .file_tr").addClass("active").removeClass("active_2"),$(".nav_group.multi").removeClass("hide"),$(".file_menu_tips").addClass("hide"),e.file_table_arry=e.file_list.slice();break;case 2:$(this).addClass("active").removeClass("active_2").data("checkbox",1),$(".file_list_content .file_tr").addClass("active"),$(".nav_group.multi").removeClass("hide"),$(".file_menu_tips").addClass("hide"),e.file_table_arry=e.file_list.slice();break;case 1:$(this).removeClass("active active_2").data("checkbox",0),$(".file_list_content .file_tr").removeClass("active"),$(".nav_group.multi").addClass("hide"),$(".file_menu_tips").removeClass("hide"),e.file_table_arry=[]}e.calculate_table_active()}),$(".file_list_content").on("click",".file_checkbox",function(t){var i=$(this).parents(".file_tr"),a=i.data("index"),l=i.data("filename");i.hasClass("active")?(i.removeClass("active"),e.remove_check_file(e.file_table_arry,"filename",l)):(i.addClass("active"),i.attr("data-filename",e.file_list[a].filename),e.file_table_arry.push(e.file_list[a])),e.calculate_table_active(),t.stopPropagation()}),$(".file_list_content").scroll(function(e){$(this).scrollTop()==$(this)[0].scrollHeight-$(this)[0].clientHeight?($(this).prev().css("opacity",1),$(this).next().css("opacity",0)):$(this).scrollTop()>0?$(this).prev().css("opacity",1):0==$(this).scrollTop()&&($(this).prev().css("opacity",0),$(this).next().css("opacity",1))}),$(".file_table_view .file_list_content").on("click",".file_tr",function(t){if($(t.target).hasClass("foo_menu_title")||$(t.target).parents().hasClass("foo_menu_title"))return!0;$(this).addClass("active").siblings().removeClass("active"),e.file_table_arry=[e.file_list[$(this).data("index")]],e.calculate_table_active(),t.stopPropagation(),t.preventDefault()}),$(".file_table_view .file_list_content").on("click",".file_name .iconfont",function(t){var i=$(this).parents(".file_tr"),a=i.data("index"),l=e.file_list[a];l.index=a,$(this).hasClass("icon-share1")&&e.info_file_share(l),$(this).hasClass("icon-favorites")&&e.cancel_file_favorites(l),t.stopPropagation()}),$(".file_table_view .file_list_content").on("dblclick",".file_tr",function(t){var i=$(this).data("index"),a=e.file_list[i];if($(t.target).hasClass("file_check")||$(t.target).parents(".foo_menu").length>0||$(t.target).hasClass("set_file_ps")||e.is_editor)return!1;if("dir"==a.type){if("Recycle_bin"==a.filename)return e.recycle_bin_view();e.reader_file_list({path:e.file_path+"/"+a.filename,is_operating:!0})}else switch(a.open_type){case"text":openEditorView(0,a.path);break;case"video":e.open_video_play(a);break;case"images":e.open_images_preview(a);break;case"compress":e.unpack_file_to_path(a)}t.stopPropagation(),t.preventDefault()}),$(".file_table_view .file_list_content").on("click",".file_title i,.file_ico_type .file_icon",function(t){var i=$(this).parents(".file_tr"),a=i.data("index"),l=e.file_list[a];if("dir"==l.type){if("Recycle_bin"==l.filename)return e.recycle_bin_view();e.reader_file_list({path:e.file_path+"/"+l.filename,is_operating:!0})}else layer.msg("compress"==l.open_type?"Double click to unzip the file":"Double click to edit the file");t.stopPropagation(),t.preventDefault()}),$(".file_list_content").on("contextmenu",function(e){return"createArea"==$(e.target).attr("name")||"rename_file_input"==$(e.target).attr("name")}),$(".selection_right_menu").on("contextmenu",function(e){return!1}),$(".file_list_content").on("mousedown",".file_tr",function(t){if(1===t.which&&($(t.target).hasClass("foo_menu_title")||$(t.target).parents().hasClass("foo_menu_title")))e.render_file_groud_menu(t,this),$(t.target).parent().addClass("foo_menu_click"),$(this).siblings().find(".foo_menu").removeClass("foo_menu_click"),$(this).addClass("active").siblings().removeClass("active");else{if(3!==t.which||e.is_editor)return!0;e.file_table_arry.length>1?e.render_files_multi_menu(t):(e.render_file_groud_menu(t,this),$(".content_right_menu").removeAttr("style"),$(this).addClass("active").siblings().removeClass("active"))}t.stopPropagation(),t.preventDefault()}),$(".filePage").on("change",".showRow",function(){var t=$(this).val();bt.set_cookie("showRow",t),e.reader_file_list({showRow:t,p:1,is_operating:!1})}),$(".filePage").on("click","div:nth-child(2) a",function(t){var i=$(this).attr("href").match(/p=([0-9]+)$/)[1];e.reader_file_list({path:e.path,p:i}),t.stopPropagation(),t.preventDefault()}),$(".file_list_content").on("click",".folder_size",function(t){var i=e.file_list[$(this).parents(".file_tr").data("index")],a=this;e.get_file_size({path:i.path},function(e){$(a).text(bt.format_size(e.size))}),t.stopPropagation(),t.preventDefault()}),$(".filePage").on("click","#file_all_size",function(t){if("/"===e.file_path)return layer.tips('The current directory is document root (/),calculate size will occupy<span class="bt_danger">massive server IO</span>,continue?',this,{tips:[1,"red"],time:5e3}),!1;e.get_dir_size({path:e.file_path})}),$(".file_list_content").on("mousedown",function(t){
if($(t.target).hasClass("file_checkbox")||$(t.target).hasClass("file_check")||$(t.target).hasClass("icon-share1")||$(t.target).hasClass("icon-favorites")||"i"==t.target.localName||$(t.target).parents(".app_menu_group").length>0||$(t.target).hasClass("createModel")||$(t.target).hasClass("editr_tr")||"createArea"==$(t.target).attr("name")||"rename_file_input"==$(t.target).attr("name")||$(t.target).hasClass("set_file_ps")||e.is_editor)return!0;if(3==t.which&&!e.is_editor)return $(".selection_right_menu").removeAttr("style"),e.render_file_all_menu(t,this),!0;$(".file_list_content").bind("mousewheel",function(){return!1});var i=$(this),a=0,l=i.offset().top,s=i.offset().left,n={top:t.clientY-$(this).offset().top,left:t.clientX-$(this).offset().left};$(document).unbind("mousemove").mousemove(function(t){var o={top:t.clientY-l>0&&t.clientY-l<i.height()?t.clientY-l:t.clientY-(l+i.height())>1?i.height():0,left:t.clientX-s>0&&t.clientX-s<i.width()?t.clientX-s:t.clientX-(s+i.width())>1?i.width():0},r={top:o.top>n.top?n.top:o.top,left:o.left>n.left?n.left:o.left};"list"==bt.get_cookie("rank")&&(r.top=r.top+40);var c=Math.min(Math.abs(o.left-n.left),s+i.width()-r.left),d=Math.min(Math.abs(o.top-n.top),l+i.height()-r.top);if(t.clientY-l<0){var p=Math.abs(t.clientY-l);i.scrollTop(i.scrollTop()-p),0!=i.scrollTop()&&(a+=p),d+=a}if(t.clientY-(l+i.height())>1){var _=t.clientY-(l+i.height());i.scrollTop(i.scrollTop()+_),i[0].scrollHeight-i[0].scrollTop!==i[0].clientHeight&&(a+=_),d+=a,r.top=r.top-a}if(n.top==o.top||n.left==o.left)return!0;e.enter_files_box().show().css({left:r.left+"px",top:r.top+"px",width:c+"px",height:d+"px"});var f=e.enter_files_box().offset().top,h=e.enter_files_box().offset().left,u=e.enter_files_box().offset().left+e.enter_files_box().width(),m=e.enter_files_box().offset().top+e.enter_files_box().height();$(i).find(".file_tr").each(function(e,t){var i=$(t).offset().top,a=$(t).offset().left,l=$(t).offset().top+$(t).height(),s=$(t).offset().left+$(t).width();"icon"==bt.get_cookie("rank")?s>=h&&a<=u&&l>=f&&i<=m?$(t).addClass("active"):$(t).removeClass("active"):s>=h&&l>=f&&i<=m?$(t).addClass("active"):$(t).removeClass("active")})}),$(document).on("mouseup",function(){var t=[],a=e.enter_files_box().offset().top,l=e.enter_files_box().offset().left,s=e.enter_files_box().offset().left+e.enter_files_box().width(),n=e.enter_files_box().offset().top+e.enter_files_box().height();$(i).find(".file_tr").each(function(e,i){var o=$(i).offset().top,r=$(i).offset().left,c=$(i).offset().top+$(i).height(),d=$(i).offset().left+$(i).width();"icon"==bt.get_cookie("rank")?d>=l&&r<=s&&c>=a&&o<=n&&t.push($(i).data("index")):d>=l&&c>=a&&o<=n&&t.push($(i).data("index"))}),e.render_file_selected(t),e.enter_files_box().remove(),$(".file_list_content").unbind("mousewheel")}),t.stopPropagation(),t.preventDefault()}),$(".file_list_content").on("blur",".set_file_ps",function(t){var i=$(this).parents(".file_tr").data("index"),a=e.file_list[i],l=$(this).val(),s=$(this).data("value"),n=this;if(l==s)return!1;bt_tools.send("files/set_file_ps",{filename:a.path,ps_type:0,ps_body:l},function(e){$(n).data("value",l)},{tips:"Set ps",tips:!0})}),$(".file_list_content").on("keyup",".set_file_ps",function(e){13==e.keyCode&&$(this).blur(),e.stopPropagation()}),$(".file_list_header").on("mousedown",".file_width_resize",function(e){return!1}),$(".cut_view_model").on("click",function(){var e=$(this).data("type");$(".file_table_view").addClass("icon"==e?"icon_view":"list_view").removeClass("icon"!=e?"icon_view":"list_view").scrollLeft(0),bt.set_cookie("rank",e),$(this).addClass("active").siblings().removeClass("active")}),$(".file_list_content").on("click",".set_operation_group a",function(t){var i=$(this).parents(".file_tr").data(),a=$(this).data("type"),l=e.file_list[i.index];if("more"==a)return!0;l.open=a,l.index=i.index,l.type_tips="file"==l.type?"File":"Directory",e.file_groud_event(l)})},enter_files_box:function(){return 0==$("#web_mouseDrag").length&&$("<div></div>",{id:"web_mouseDrag",style:["position:absolute; top:0; left:0;","border:1px solid #072246; background-color: #cce8ff;","filter:Alpha(Opacity=15); opacity:0.15;","overflow:hidden;display:none;z-index:9;"].join("")}).appendTo(".file_table_view"),$("#web_mouseDrag")},clear_table_active:function(){this.file_table_arry=[],$(".file_list_header .file_check").removeClass("active active_2"),$(".file_list_content .file_tr").removeClass("active app_menu_operation"),$(".file_list_content .file_tr .file_ps .foo_menu").removeClass("foo_menu_click"),$(".app_menu_group").remove()},calculate_table_active:function(){var e=this,t=$(".file_list_header .file_check");0==this.file_table_arry.length?t.removeClass("active active_2").data("checkbox",0):this.file_table_arry.length==this.file_list.length?t.addClass("active").removeClass("active_2").data("checkbox",1):t.addClass("active_2").removeClass("active").data("checkbox",2),this.file_table_arry.length>0?($(document).unbind("keydown").on("keydown",function(t){var i=t.keyCode,a=t.target.localName.toLowerCase();window.navigator.userAgent.indexOf("Mac");if("input"==a||"textarea"==a)return!0;t.ctrlKey&&67==i&&(1==e.file_table_arry.length?(e.file_groud_event($.extend(e.file_table_arry[0],{open:"copy"})),$(".file_all_paste").removeClass("hide")):e.file_table_arry.length>1&&e.batch_file_manage("copy")),t.ctrlKey&&88==i&&(1==e.file_table_arry.length?(e.file_groud_event($.extend(e.file_table_arry[0],{open:"shear"})),$(".file_all_paste").removeClass("hide")):e.file_table_arry.length>1&&e.batch_file_manage("shear"))}),this.file_table_arry.length>1?($(".nav_group.multi").removeClass("hide"),$(".file_menu_tips").addClass("hide")):($(".nav_group.multi").addClass("hide"),$(".file_menu_tips").removeClass("hide"))):($(".nav_group.multi").addClass("hide"),$(".file_menu_tips.multi").removeClass("hide"),$(document).unbind("keydown")),$(".selection_right_menu,.file_path_input .file_dir_item .nav_down_list").removeAttr("style"),e.set_menu_line_view_resize()},set_dir_view_resize:function(){var e=$(".file_path_input"),t=$(".file_path_input .file_dir_view"),i=t.attr("data-width"),a=null;if(i?parseInt(i):(i=t.width(),t.attr("data-width",i)),t.width()-i<90){var l=0;$($(".file_path_input .file_dir_view .file_dir_item").toArray().reverse()).each(function(){var t=0;$(this).attr("data-width")?t=parseInt($(this).attr("data-width")):($(this).attr("data-width",$(this).width()),t=$(this).width()),l+=t,e.width()-l<=90?$(this).addClass("hide"):$(this).removeClass("hide")})}a=t.children(".file_dir_item.hide").clone(!0);0==t.children(".file_dir_item.hide").length?e.removeClass("active").find(".file_dir_omit").addClass("hide"):(a.each(function(){0==$(this).find(".glyphicon-hdd").length&&$(this).find(".file_dir").before('<span class="file_dir_icon"></span>')}),e.addClass("active").find(".file_dir_omit").removeClass("hide"),e.find(".file_dir_omit .nav_down_list").empty().append(a),e.find(".file_dir_omit .nav_down_list .file_dir_item").removeClass("hide"))},set_menu_line_view_resize:function(){var e=$(".file_nav_view").width(),t=0,i=0,a=$(".mount_disk_list"),l=$(".nav_group.multi");a.attr("data-width")||a.attr("data-width",a.innerWidth()),l.attr("data-width")||0==l.innerWidth()||-1==l.innerWidth()||l.attr("data-width",l.innerWidth()),t=parseInt(a.attr("data-width")),parseInt(l.attr("data-width")),$(".file_nav_view>.nav_group").not(".mount_disk_list").each(function(){i+=$(this).innerWidth()}),i+=$(".menu-header-foot").innerWidth(),e-i<t+5?$(".nav_group.mount_disk_list").addClass("thezoom").find(".disk_title_group_btn").removeClass("hide"):$(".nav_group.mount_disk_list,.nav_group.multi").removeClass("thezoom"),this.area[0]<1700?(indexs=Math.ceil((1700-this.area[0])/68),$(".batch_group_list>.nav_btn_group").each(function(e){e>=$(".batch_group_list>.nav_btn_group").length-(indexs+2)?$(this).hide():$(this).show()}),$(".batch_group_list>.nav_btn_group:last-child").removeClass("hide").show()):($(".batch_group_list>.nav_btn_group").css("display","inline-block"),$(".batch_group_list>.nav_btn_group:last-child").addClass("hide"))},set_file_forward:function(){var e=this,t=$(".forward_path span");1==e.file_operating.length?t.addClass("active"):e.file_pointer==e.file_operating.length-1?(t.eq(0).removeClass("active"),t.eq(1).addClass("active")):0==e.file_pointer?(t.eq(0).addClass("active"),t.eq(1).removeClass("active")):t.removeClass("active")},set_file_view:function(){var e=$(".file_list_content"),t=this.area[1]-$(".file_table_view")[0].offsetTop-170;$(".file_bodys").height(this.area[1]-100),50*this.file_list.length>t?(e.attr("data-height",e.data("height")||e.height()).css({overflow:"hidden","overflow-y":"auto",height:t+"px"}),$(".file_shadow_bottom").css("opacity",1)):(e.css({overflow:"hidden","overflow-y":"auto",height:t+"px"}),$(".file_shadow_top,.file_shadow_bottom").css("opacity",0))},open_share_view:function(){var e=this;layer.open({type:1,shift:5,closeBtn:2,area:["850px","580px"],title:"Share list",content:'<div class="divtable mtb10 download_table" style="padding:5px 10px;">                    <table class="table table-hover" id="download_url">                        <thead><tr><th width="230px">Share name</th><th width="300px">Share address</th><th>Expiration date</th><th style="text-align:right;width:120px;">Opt</th></tr></thead>                        <tbody class="download_url_list"></tbody>                    </table>                    <div class="page download_url_page"></div>            </div>',success:function(){e.render_share_list(),$(".download_url_list").on("click",".info_down",function(){var t=$(this).attr("data-index");e.file_share_view(e.file_share_list[t],"list")}),$(".download_table .download_url_page").on("click","a",function(t){var i=$(this).attr("href").match(/p=([0-9]+)$/)[1];e.render_share_list({p:i}),t.stopPropagation(),t.preventDefault()})}})},render_share_list:function(e){var t=this,i="";void 0===e&&(e={p:1}),bt_tools.send("files/get_download_url_list",e,function(a){t.file_share_list=a.data,a.data.length>0?$.each(a.data,function(e,t){i+='<tr><td><span style="width:230px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;" title="'+t.ps+'">'+t.ps+'</span></td><td><span style="width:300px;white-space: nowrap;overflow:hidden;text-overflow: ellipsis;display: inline-block;" title="'+t.filename+'">'+t.filename+"</span></td><td><span>"+bt.format_data(t.expire)+'</span></td><td style="text-align:right;"><a href="javascript:;" class="btlink info_down" data-id="'+t.id+'" data-index="'+e+'">Details</a>&nbsp;|&nbsp;<a href="javascript:;" class="btlink del_down" data-id="'+t.id+'" data-index="'+e+'" data-ps="'+t.ps+'">Close</a></td></tr>'}):i='<tr><td colspan="4">No share data</td></tr>',$(".download_url_list").html(i),$(".download_url_page").html(a.page),$(".download_table").on("click",".del_down",function(){var i=$(this).attr("data-id"),a=$(this).attr("data-ps");t.remove_download_url({id:i,fileName:a},function(i){i.status&&t.render_share_list(e),layer.msg(i.msg,{icon:i.status?1:2})})})},"Share list")},remove_check_file:function(e,t,i){for(var a=e.length;a--;)e[a][t]==i&&e.splice(a,1)},open_download_view:function(){var e=this;e.reader_form_line({url:"DownloadFile",beforeSend:function(e){return{url:e.url,path:e.path,filename:e.filename}},overall:{width:"310px"},data:[{label:"URL address:",name:"url",placeholder:"URL address",value:"http://",eventType:["input","focus"],input:function(){var e=$(this).val(),t=e.split("/");$('[name="filename"]').val(t[t.length-1])}},{label:"Download to:",name:"path",placeholder:"Download to",value:e.file_path},{label:"File name:",name:"filename",placeholder:"Save file name",value:"",eventType:"enter",enter:function(){$(".download_file_view .layui-layer-btn0").click()}}]},function(t,i){var a=bt.open({type:1,title:"Download file",area:"500px",shadeClose:!1,skin:"download_file_view",content:i[0].outerHTML,btn:["Comfirm","Close"],success:function(){t.setEvent()},yes:function(i,l){var s=t.getVal();if(!bt.check_url(s.url))return layer.msg("Please enter valid URL address..",{icon:2}),!1;t.submitForm(function(t){e.render_present_task_list(),layer.msg(t.msg,{icon:t.status?1:2}),a.close()})}})})},set_style_width:function(e,t){var i=bt.get_cookie("formHeader")||$("#file_list_info").html(),a="",l=new RegExp("\\.file_"+e+"\\s?\\{width\\s?\\:\\s?(\\w+)\\s\\!important;\\}","g"),s={name:150,type:80,size:80,mtime:150,accept:80,user:80,ps:150};a=i.replace(l,function(i,a,l,n){return".file_"+e+"{width:"+(t<80?s[e]+"px":t+"px")+" !important;}"}),$("#file_list_info").html(a)},set_file_table_width:function(){var e=$(".file_table_view")[0].offsetWidth,t=0,i=0,a=0,l="",s=0,n=45,o="",r={};$.each(this.file_header,function(e,a){"auto"==a?(t++,r[e]=0):(i+=a,l+="."+e+"{width:"+("file_operation"!=e?a:a-16)+"px !important;}")}),this.is_mobile&&$(".file_operation.file_th").attr("style","margin-right:-10px !important;"),this.file_list.length*n>$(".file_list_content").height()?(r.file_tr=e-(this.is_mobile?0:this.scroll_width),e=e,o+=".file_td.file_operation{width:"+(this.file_header.file_operation-(this.is_mobile?0:this.scroll_width)-10)+"px !important;}",o+=".file_th.file_operation{padding-right:"+(10+(this.is_mobile?0:this.scroll_width))+"px !important}"):(e=e,r.file_tr=e,this.is_mobile&&(o+=".file_td.file_operation{width:"+(this.file_header.file_operation-20)+"px !important;}")),r.file_list_header=e,a=e-i,s=a/t,$.each(r,function(e,t){l+="."+e+"{width:"+(0==t?s:t)+"px !important;}"}),$("#file_list_info").html(l+o)},render_path_list:function(e){var t=this,i='<div class="file_dir_omit hide" title="Expand hidden directories"><span></span><i class="iconfont icon-zhixiang-zuo"></i><div class="nav_down_list"></div></div>',a="",l=this.file_path.split("/").splice(1),s=this.file_path.split("/")[0];"Windows"===bt.os?(0==l.length&&(l=[]),l.unshift('<span class="glyphicon glyphicon-hdd"></span><span class="ml5">Local disk ('+s+")</span>")):("/"==this.file_path&&(l=[]),l.unshift("Root dir"));for(var n=0;n<l.length;n++)a+="/"+l[n],0==n&&(a="/"),i+='<div class="file_dir_item">                        <span class="file_dir" title="'+a.replace("//","/")+'">'+l[n]+'</span>                        <i class="iconfont icon-arrow-right"></i>                        <ul class="nav_down_list">                            <li data-path="*"><span>Loading</span></li>                        </ul>                    </div>';$(".path_input").val("").attr("data-path",this.file_path);var o=$(".file_path_input .file_dir_view");o.html(i),o.attr("data-width",o.width()),t.set_dir_view_resize.delay(t,100)},render_path_down_list:function(e,t,i){var a=this,l="",s=$(e).parent().next().find(".file_dir").attr("title");this.get_dir_list({path:t},function(i){$.each(a.data_reconstruction(i.DIR),function(e,i){var a=("/"!=t?t:"")+"/"+i.filename;l+='<li data-path="'+a+'" title="'+a+'" class="'+(a===s?"active":"")+'"><i class="file_menu_icon newly_file_icon"></i><span>'+i.filename+"</span></li>"}),$(e).html(l)})},reader_file_list:function(e,t){var i=this,a="",l="",s=bt.get_cookie("rank"),n=bt.get_cookie("record_paste_type");"null"!=n&&null!=n?$(".file_nav_view .file_all_paste").removeClass("hide"):$(".file_nav_view .file_all_paste").addClass("hide"),$(".file_table_view").removeClass(".list_view,.icon_view").addClass("list"==s?"list_view":"icon_view"),$(".cut_view_model:nth-child("+("list"==s?"2":"1")+")").addClass("active").siblings().removeClass("active"),this.file_images_list=[],this.get_dir_list(e,function(s){if(!1===s.status&&s.msg.indexOf("The specified directory does not exist!")>-1)return i.reader_file_list({path:"/www"});i.file_path=i.path_check(s.PATH),i.file_list=$.merge(i.data_reconstruction(s.DIR,"DIR"),i.data_reconstruction(s.FILES)),i.is_recycle=s.FILE_RECYCLE,i.file_store_list=s.STORE,bt.set_cookie("Path",i.path_check(s.PATH)),i.reader_file_list_content(i.file_list,function(n){$(".path_input").attr("data-path",i.file_path),$(".file_nav_view .multi").addClass("hide"),$(".selection_right_menu").removeAttr("style"),$.each(["100","200","500","1000","2000"],function(e,t){a+='<option value="'+t+'" '+(t==(bt.get_storage("local","showRow")||i.file_page_num)?"selected":"")+">"+t+"</option>"});var o=$(s.PAGE);o.append('<span class="Pcount-item">per page<select class="showRow">'+a+"</select>item(s)</span>"),$(".filePage").html('<div class="page_num">Total '+n.is_dir_num+" directory, "+(i.file_list.length-n.is_dir_num)+'file(s), size:<a href="javascript:;" class="btlink" id="file_all_size">Click to calculate</a></div>'+o[0].outerHTML),e.is_operating&&i.file_operating[i.file_pointer]!=s.PATH&&(l=i.file_operating[i.file_pointer+1],void 0!==l&&l!=s.PATH&&i.file_operating.splice(i.file_pointer+1),i.file_operating.push(s.PATH),i.file_pointer=i.file_operating.length-1),i.render_path_list(),i.set_file_forward(),i.render_favorites_list(),i.set_file_view(),i.set_file_table_width(),t&&t(s)})})},data_reconstruction:function(e,t,i){var a=this,l=[],s=[["/etc","PS: System files directory"],["/home","PS: Home directory"],["/tmp","PS: Common temporary files directory"],["/root","PS: Main directory of system admin"],["/usr","PS: System application directory"],["/boot","PS: System run directory"],["/lib","PS: System source file directory"],["/mnt","PS: Store temporary mapped file system"],["/www","PS: Aapanel program directory"],["/bin","PS: Store binary executable file directory"],["/dev","PS: Storage device file directory"],["/www/wwwlogs","PS: Default site logs directory"],["/www/server","PS: Aapanel soft installed directory"],["/www/wwwlogs","PS: Site logs directory"],["/www/Recycle_bin",lan.files.recycle_bin_dir],["/www/server/panel","PS: Aapanel main program directory, do not move"],["/www/server/panel/plugin","PS: Aapanel plugin directory"],["/www/server/panel/BTPanel","PS: Aapanel directory"],["/www/server/panel/BTPanel/static","PS: Aapanel static directory"],["/www/server/panel/BTPanel/templates","PS: Aapanel templates directory"],[bt.get_cookie("backup_path"),"PS: Default backup directory"],[bt.get_cookie("sites_path"),"PS: Default site directory"]];return e.length<1?[]:($.each(e,function(e,i){var n=i.split(";"),o="",r=n[0].split("."),c=r[r.length-1];switch(n[0]){case".user.ini":o=lan.files.php_profile;break;case".htaccess":o=lan.files.apache_profile;break;case"swap":o=lan.files.swap_file}-1!=n[0].indexOf("Recycle_bin")&&(o=lan.files.swap_file),-1!=n[0].indexOf(".upload.tmp")&&(o=lan.files.recycle_bin_dir);for(var d=0;d<s.length;d++)a.path_resolve(a.file_path,n[0])===s[d][0]&&(o=s[d][1]);l.push({caret:"1"==n[8],down_id:parseInt(n[9]),ext:"DIR"==t?"":c.toLowerCase(),filename:n[0],mtime:n[2],ps:o||n[10]||"",is_os_ps:""!=o,size:n[1],type:"DIR"==t?"dir":"file",user:n[3],root_level:n[4],soft_link:n[5]||""})}),l)},render_file_selected:function(e){$(document).unbind("mouseup").unbind("mousemove");var t=this,i=[];t.clear_table_active(),$.each(e,function(e,t){-1==i.indexOf(t)&&i.push(t)}),$.each(i,function(e,i){$(".file_list_content .file_tr").eq(i).addClass("active"),t.file_table_arry.push(t.file_list[i])}),t.calculate_table_active()},render_favorites_list:function(){var e="";this.file_store_list.length>0?($.each(this.file_store_list,function(t,i){e+='<li title="'+i.name+'" data-path="'+i.path+'" data-type="'+i.type+'"><i class="'+("file"==i.type?"file_new_icon":"file_menu_icon create_file_icon")+'"></i><span>'+i.name+"</span></li>"}),e+='<li data-manage="favorites" onclick="bt_file.set_favorites_manage()"><span class="iconfont icon-shezhi1"></span><span>Management</span></li>'):e='<li data-null style="width: 150px;"><i></i><span>(Empty)</span></li>',$(".favorites_file_path .nav_down_list").html(e)},set_favorites_manage:function(){var e=this;layer.open({type:1,title:"Manage Favorites",area:["850px","580px"],closeBtn:2,shift:5,shadeClose:!1,content:"<div class='stroe_tab_list bt-table pd15'>                    <div class='divtable' style='height:420px'>                    <table class='table table-hover'>                        <thead><tr><th>Path</th><th style='text-align:right'>Opt</th></tr></thead>                        <tbody class='favorites_body'></tbody>                    </table></div></div>",success:function(t){e.render_favorites_type_list(),setTimeout(function(){$(t).css("top",($(window).height()-$(t).height())/2)},50)},cancel:function(){e.reader_file_list({path:e.file_path})}})},render_favorites_type_list:function(){var e="";this.$http("get_files_store",function(t){t.length>0?$.each(t,function(t,i){e+='<tr><td><span class="favorites_span" title="'+i.path+'">'+i.path+'</span></td><td style="text-align:right;"><a class="btlink" onclick="bt_file.del_favorites(\''+i.path+"')\">Del</a></td></tr>"}):e='<tr><td colspan="2">No favorites</td></tr>',$(".favorites_body").html(e),jQuery.prototype.fixedThead?$(".stroe_tab_list .divtable").fixedThead({resize:!1}):$(".stroe_tab_list .divtable").css({overflow:"auto"})})},load_favorites_index_list:function(){var e=this;this.$http("get_files_store",function(t){e.file_store_list=t,e.render_favorites_list()})},del_favorites:function(e){var t=this;layer.confirm("Comfirm delete path【"+e+"】？",{title:"Delete favorites",closeBtn:2,icon:3},function(i){t.$http("del_files_store",{path:e},function(e){e.status&&t.render_favorites_type_list(),layer.msg(e.msg,{icon:e.status?1:2})})})},reader_file_list_content:function(e,t){var i="",a=this,l=0,s=0;$.each(e,function(e,t){t.filename;var n=bt.get_random(10),o=(a.file_path+"/"+t.filename).replace("//","/"),r=a.determine_file_type(t.ext,"compress"),c=function(){var e="open";switch(a.determine_file_type(t.ext)){case"images":e="Preview";break;case"video":e="Play";break;default:e="compress"==a.determine_file_type(t.ext)?"":"Edit"}return"dir"==t.type&&(e="Open"),e}();a.file_list[e].only_id=n,i+='<div class="file_tr" data-index="'+e+'" data-filename="'+t.filename+'" '+("icon"==bt.get_cookie("rank")?'title="'+o+"&#13;"+lan.files.file_size+":"+bt.format_size(t.size)+"&#13;"+lan.files.file_etime+":"+bt.format_data(t.mtime)+"&#13;"+lan.files.file_auth+":"+t.user+"&#13;"+lan.files.file_own+":"+t.root_level+'"':"")+'><div class="file_td file_checkbox"><div class="file_check"></div></div><div class="file_td file_name"><div class="file_ico_type"><i class="file_icon '+("dir"==t.type?"file_folder":(""==t.ext?"":"file_"+t.ext).replace("//","/"))+'"></i></div><span class="file_title file_'+t.type+'_status" '+("icon"==bt.get_cookie("rank")?"":'title="'+o+'"')+"><i>"+t.filename+t.soft_link+"</i></span>"+(t.caret?'<span class="iconfont icon-favorites" style="'+(0!=t.down_id?"right:30px":"")+'" title="'+lan.files.file_has_been_favorite+'"></span>':"")+(0!=t.down_id?'<span class="iconfont icon-share1" title="'+lan.files.file_has_been_shared+'"></span>':"")+'</div><div class="file_td file_type hide"><span title="'+("dir"==t.type?"directory":a.ext_type_tips(t.ext))+'">'+("dir"==t.type?"directory":a.ext_type_tips(t.ext))+'</span></div><div class="file_td file_accept"><span>'+t.user+" / "+t.root_level+'</span></div><div class="file_td file_size"><span>'+("dir"==t.type?'<a class="btlink folder_size" href="javascript:;" data-path="'+o+'">Calculate</a>':bt.format_size(t.size))+'</span></div><div class="file_td file_mtime"><span>'+bt.format_data(t.mtime)+'</span></div><div class="file_td file_ps"><span class="file_ps_title" title="'+t.ps+'">'+(t.is_os_ps?t.ps:'<input type="text" class="set_file_ps" data-value="'+t.ps+'" value="'+t.ps+'" />')+'</span></div><div class="file_td file_operation"><div class="set_operation_group '+(a.is_mobile?"is_mobile":"")+'"><a href="javascript:;" class="btlink" data-type="open">'+c+'</a>&nbsp;|&nbsp;<a href="javscript:;" class="btlink" data-type="copy">Copy</a>&nbsp;|&nbsp;<a href="javscript:;" class="btlink" data-type="shear">Cut</a>&nbsp;|&nbsp;<a href="javscript:;" class="btlink" data-type="rename">Rename</a>&nbsp;|&nbsp;<a href="javscript:;" class="btlink" data-type="authority">PMSN</a>&nbsp;|&nbsp;<a href="javascript:;" class="btlink" data-type="'+(r?"unzip":"compress")+'">'+(r?"Unzip":"Zip")+'</a>&nbsp;|&nbsp;<a href="javscript:;" class="btlink" data-type="del">Del</a>&nbsp;|&nbsp;<a href="javscript:;" class="btlink foo_menu_title" data-type="more">More<i></i></a></div></div></div>',"dir"==t.type&&l++,t.path=o,t.open_type=a.determine_file_type(t.ext),"images"==t.open_type&&(t.images_id=s,a.file_images_list.push(t.path),s++)}),$(".file_list_content").html(i),t&&t({is_dir_num:l}),a.clear_table_active()},render_file_disk_list:function(){var e=this,t="",i="";e.get_disk_list(function(a){$.each(a,function(e,a){t+='<div class="nav_btn" data-menu="'+a.path+'"><span class="glyphicon glyphicon-hdd"></span><span>'+("/"==a.path?"Root dir":a.path)+" ("+a.size[2]+")</span></div>",i+='<li data-disk="'+a.path+'"><i class="glyphicon glyphicon-hdd"></i><span>'+("/"==a.path?"Root dir":a.path)+" ("+a.size[2]+")</span></li>"}),$(".mount_disk_list").html('<div class="disk_title_group_btn hide"><span class="disk_title_group">'+lan.files.mounted_disk+'</span><i class="iconfont icon-xiala"></i><ul class="nav_down_list">'+i+'</ul></div><div class="file_disk_list">'+t+"</div>"),e.set_menu_line_view_resize()})},render_file_groud_menu:function(e,t){var i=this,a=$(t).data("index"),l="Open",s=i.file_list[a],n=["zip","rar","gz","war","tgz","bz2"],o={open:l,split_0:!0,download:"Download",share:"Share file",cancel_share:"Cancel share",favorites:"Favorites file",cancel_favorites:"Cancel favorites",split_1:!0,authority:"Permission",split_2:!0,copy:"Copy",shear:"Cut",rename:"Rename",del:"Delete",split_3:!0,compress:"Compress",unzip:"Unzip",open_find_dir:"Open file location",split_4:!0,property:"Properties"};switch(i.determine_file_type(s.ext)){case"images":l="Preview";break;case"video":l="Play";break;default:l="Edit"}o.open="dir"==s.type?"Open":l,"dir"===s.type&&delete o.download,"compress"==s.open_type&&delete o.open,0!=s.down_id?delete o.share:(delete o.cancel_share,o.share="dir"==s.type?"Share dir":"Share file"),!1!==s.caret?delete o.favorites:(delete o.cancel_favorites,o.favorites="dir"==s.type?"Favorites dir":"Favorites file"),"php"==s.ext&&(o.dir_kill="文件查杀"),"php"!=s.ext&&"dir"!=s.type&&delete o.dir_kill;var r=0;$.each(n,function(e,t){t==s.ext&&r++}),0==r&&delete o.unzip,s.is_search?o.open_find_dir="dir"==s.type?"Open dir":"Open file location":delete o.open_find_dir,i.file_selection_operating=o,i.reader_menu_list({el:$(".selection_right_menu"),ev:e,data:s,list:o})},render_file_all_menu:function(e,t){var i=this,a={refresh:"Refresh",split_0:!0,upload:"Upload",create:["New file/folder",{create_dir:"New folder",create_files:"New file",soft_link:"Softlink"}],web_shell:"Terminal",split_1:!0,paste:"Paste"},l=bt.get_cookie("record_paste_type");"null"!=l&&null!=l||(delete a.split_1,delete a.paste),i.reader_menu_list({el:$(".selection_right_menu"),ev:e,data:{},list:a})},render_files_multi_menu:function(e){var t=this,i=[["copy","Copy"],["shear","cut"],["authority","Permission"],["compress","Compress"],["del","Delete"]],a=$(".selection_right_menu").find("ul"),l=a.height(),s=a.width(),n=e.clientX-(this.area[0]-e.clientX<s?s:0);a.empty(),$.each(i,function(e,i){var l,s=null;"split"==i[0]?a.append('<li class="separate"></li>'):a.append($('<li><i class="file_menu_icon '+i[0]+"_file_icon "+(l=i[0],"authority"==l?"iconfont icon-authority":"")+'"></i><span>'+i[1]+"</span></li>").append(s).on("click",{type:i[0],data:t.file_table_arry},function(e){$(".selection_right_menu").removeAttr("style"),t.batch_file_manage(e.data.type),e.stopPropagation(),e.preventDefault()}))}),$(".selection_right_menu").css({left:n,top:e.clientY-(this.area[1]-e.clientY<l?l:0)}).removeClass("left_menu right_menu").addClass(this.area[0]-(n+s)<230?"left_menu":"right_menu"),$(document).one("click",function(t){$(e.currentTarget).removeClass("selected"),$(".selection_right_menu").removeAttr("style"),t.stopPropagation(),t.preventDefault()})},reader_menu_list:function(e){var t=this,i=e.el.find("ul"),a=0,l=i.width(),s=e.ev.clientX-(this.area[0]-e.ev.clientX<l?l:0),n=0;i.empty(),$.each(e.list,function(a,l){var s=null,n=null;"boolean"==typeof l?i.append('<li class="separate"></li>'):(Array.isArray(l)&&(s=$('<div class="file_menu_down"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span><ul class="set_group"></ul></div>'),n=s.find(".set_group"),$.each(l[1],function(i,a){n.append($('<li><i class="file_menu_icon '+i+'_file_icon"></i><span>'+a+"</span></li>").on("click",{type:i,data:e.data},function(i){t.file_groud_event($.extend(i.data.data,{open:i.data.type,index:parseInt($(e.ev.currentTarget).data("index")),element:e.ev.currentTarget,type_tips:"dir"==e.data.type?"folder":"file"})),e.el.removeAttr("style"),i.stopPropagation(),i.preventDefault()}))})),i.append($('<li><i class="file_menu_icon '+a+"_file_icon "+function(e){switch(e){case"share":case"cancel_share":return"iconfont icon-share1";case"dir_kill":return"iconfont icon-dir_kill";case"authority":return"iconfont icon-authority"}return""}(a)+'"></i><span>'+(Array.isArray(l)?l[0]:l)+"</span></li>").append(s).on("click",{type:a,data:e.data},function(i){t.file_groud_event($.extend(i.data.data,{open:i.data.type,index:parseInt($(e.ev.currentTarget).data("index")),element:e.ev.currentTarget,type_tips:"dir"==e.data.type?"folder":"file"})),"compress"!=a&&"create"!=a&&e.el.removeAttr("style"),i.stopPropagation(),i.preventDefault()})))}),a=i.innerHeight(),n=e.ev.clientY-(this.area[1]-e.ev.clientY<a?a:0);var o=$(e.ev.target);(o.hasClass("foo_menu_title")||o.parents().hasClass("foo_menu_title"))&&(s=e.ev.clientX-l,n=this.area[1]-e.ev.clientY<a?e.ev.clientY-a-20:e.ev.clientY+15),e.el.css({left:s+10,top:n}).removeClass("left_menu right_menu").addClass(this.area[0]-(s+l)<230?"left_menu":"right_menu")},ext_type_tips:function(e){var t={ai:"Adobe Illustrator format",apk:"Android package",asp:"Dynamic web file",bat:"Shell File",bin:"Bin File",bas:"BASIC File",bak:"Backup File",css:"CSS",cad:"备份文件",cxx:"C++",crt:"Certificate file",cpp:"C++ File",conf:"Configuration file",dat:"",der:"Certification file",doc:"Microsoft Office Word 97-2003",docx:"Microsoft Office Word 2007",exe:"",gif:"Graphic file",go:"Golang source files",htm:"Hypertext document",html:"Hypertext document",ico:"",java:"Java source files",access:"Database file",jsp:"HTML Page",jpe:"Graphic file",jpeg:"Graphic file",jpg:"Graphic file",log:"Log file",link:"Shortcut file",js:"Javascript source files",mdb:"Microsoft Access database",mp3:"Audio file",ape:"CloudMusic.ape",mp4:"Video",avi:"Video",mkv:"Video",rm:"Video",mov:"Video",mpeg:"Video",mpg:"Video",rmvb:"Video",webm:"Video",wma:"Video",wmv:"Video",swf:"Shockwave Flash Object",mng:"Multi-image network graphics",msi:"Windows package",png:"Graphic file",py:"Python source file",pyc:"Python Bytecode file",pdf:"pdf",ppt:"Microsoft Powerpoint 97-2003",pptx:"Microsoft Powerpoint2007",psd:"Adobe photoshop",pl:"Perl Scripting language",rar:"RAR compressed package",reg:"Registry file",sys:"System Files",sql:"Database file",sh:"Shell script file",txt:"text format",vb:"Visual Basic",xml:"",xls:"Microsoft Office Excel 97-2003",xlsx:"Microsoft Office Excel 2007",gz:"Compressed file",zip:"ZIP compressed file",z:"","7z":"7Z Compressed file",json:"JSON",php:"PHP",mht:"MHTML",bmp:"BMP",webp:"WEBP",cdr:"CDR"};return void 0!==t[e]?t[e]:"Unknown file"},determine_file_type:function(e,t){var i={images:["jpg","jpeg","png","bmp","gif","tiff","ico","JPG","webp"],compress:["zip","rar","gz","war","tgz"],video:["mp4","mp3","mpeg","mpg","mov","avi","webm","mkv","mkv","mp3","rmvb","wma","wmv"],ont_text:["iso","xlsx","xls","doc","docx","tiff","exe","so","7z","bz","dmg","apk","pptx","ppt","xlsb","pdf"]},a=!1;if(null!=t)if("text"==t)$.each(i,function(t,i){$.each(i,function(t,i){if(i==e)return a=!0,!1})}),a=!a;else{if(void 0===i[t])return!1;$.each(i[t],function(t,i){if(i==e)return a=!0,!1})}else $.each(i,function(t,i){$.each(i,function(i,l){if(l==e)return a=t,!1})}),"boolean"==typeof a&&(a="text");return a},file_groud_event:function(e){var t=this;switch(e.open){case"open":
if("dir"==e.type)this.reader_file_list({path:e.path});else switch(e.open_type){case"text":openEditorView(0,e.path);break;case"video":this.open_video_play(e);break;case"images":this.open_images_preview(e)}break;case"download":this.down_file_req(e);break;case"share":this.set_file_share(e);break;case"cancel_share":this.info_file_share(e);break;case"favorites":this.$http("add_files_store",{path:e.path},function(i){i.status&&(t.file_list[e.index]=$.extend(t.file_list[e.index],{caret:!0}),t.reader_file_list_content(t.file_list),t.load_favorites_index_list()),layer.msg(i.msg,{icon:i.status?1:2})});break;case"cancel_favorites":this.cancel_file_favorites(e);break;case"authority":this.set_file_authority(e);break;case"dir_kill":this.set_dir_kill(e);break;case"copy":this.copy_file_or_dir(e);break;case"shear":this.cut_file_or_dir(e);break;case"rename":this.rename_file_or_dir(e);break;case"compress":e.open="tar_gz",this.compress_file_or_dir(e);break;case"tar_gz":case"rar":case"zip":this.compress_file_or_dir(e);break;case"unzip":case"folad":this.unpack_file_to_path(e);break;case"refresh":$(".file_path_refresh").click();break;case"upload":this.file_drop.dialog_view();break;case"soft_link":this.set_soft_link();break;case"create_dir":$(".file_nav_view .create_file_or_dir li").eq(0).click();break;case"create_files":$(".file_nav_view .create_file_or_dir li").eq(1).click();break;case"del":this.del_file_or_dir(e);break;case"paste":this.paste_file_or_dir();break;case"web_shell":web_shell();break;case"open_find_dir":this.reader_file_list({path:this.retrun_prev_path(e.path)});break;case"property":this.open_property_view(e)}},batch_file_manage:function(e){var t=this,i="",a=[],l={};$("");switch($.each(this.file_table_arry,function(e,t){a.push(t.filename)}),e){case"copy":case"shear":i="SetBatchData",l.data=JSON.stringify(a),l.type="copy"==e?"1":"2",l.path=t.file_path;break;case"del":return l.data=JSON.stringify(a),l.type="4",l.path=t.file_path,t.batch_file_delect(l);case"authority":return l.filename="批量",l.type="3",l.filelist=JSON.stringify(a),l.path=t.file_path,t.set_file_authority(l,!0);case"compress":var s=t.file_path.split("/"),n=s[s.length-1];return l.filename=a.join(","),l.open="tar_gz",l.path=t.file_path+"/"+n,t.compress_file_or_dir(l,!0)}t.$http(i,l,function(i){i.status&&(bt.set_cookie("record_paste_type","copy"==e?"1":"2"),t.clear_table_active(),$(".nav_group.multi").addClass("hide"),$(".file_menu_tips").removeClass("hide"),$(".file_nav_view .file_all_paste").removeClass("hide")),layer.msg(i.msg,{icon:i.status?1:2})})},batch_file_delect:function(e){var t=this;this.is_recycle?layer.confirm(lan.files.del_to_recycle_bin,{title:lan.files.del_in_bulk,closeBtn:2,icon:3},function(){t.$http("SetBatchData",e,function(e){e.status&&t.reader_file_list({path:t.file_path}),layer.msg(e.msg,{icon:e.status?1:2})})}):bt.show_confirm(lan.files.del_in_bulk,'<span><i style="font-size: 15px;font-style: initial;color: red;">'+lan.files.recycle_bin_warning+"</i></span>",function(){t.$http("SetBatchData",e,function(e){e.status&&t.reader_file_list({path:t.file_path}),layer.msg(e.msg,{icon:e.status?1:2})})})},batch_file_paste:function(){var e=this,t=bt.get_cookie("record_paste_type");this.check_exists_files_req({dfile:this.file_path},function(i){if(i.length>0){for(var a="",l=0;l<i.length;l++)a+='<tr><td><span class="exists_files_style">'+i[l].filename+"</td><td>"+ToSize(i[l].size)+"</td><td>"+getLocalTime(i[l].mtime)+"</td></tr>";var s='<div class="divtable" style="max-height:350px;overflow:auto;"><table class="table table-hover" width="100%" border="0" cellpadding="0" cellspacing="0"><thead><th>File name</th><th>Size</th><th>Last edit time</th></thead>                            <tbody>'+a+"</tbody>                            </table></div>";SafeMessage("The following files will be overwritten",s,function(){e.$http("BatchPaste",{type:t,path:e.file_path},function(t){t.status&&(bt.set_cookie("record_paste_type",null),e.reader_file_list({path:e.file_path})),layer.msg(t.msg,{icon:t.status?1:2})})})}else e.$http("BatchPaste",{type:t,path:e.file_path},function(t){t.status&&(bt.set_cookie("record_paste_type",null),e.reader_file_list({path:e.file_path})),layer.msg(t.msg,{icon:t.status?1:2})})})},recycle_bin_view:function(){var e=this;layer.open({type:1,shift:5,closeBtn:2,area:["80%","606px"],title:lan.files.recycle_bin_title,content:'<div class="recycle_bin_view">                    <div class="re-head">                    <div style="margin-left: 3px;" class="ss-text">                        <em>'+lan.files.recycle_bin_on+'</em>                        <div class="ssh-item">                          <input class="btswitch btswitch-ios" id="Set_Recycle_bin" type="checkbox">                          <label class="btswitch-btn" for="Set_Recycle_bin" onclick="bt_file.Set_Recycle_bin()"></label>                        </div>                        <em style="margin-left: 20px;">'+lan.files.recycle_bin_on_db+'</em>                        <div class="ssh-item">                                <input class="btswitch btswitch-ios" id="Set_Recycle_bin_db" type="checkbox">                                <label class="btswitch-btn" for="Set_Recycle_bin_db" onclick="bt_file.Set_Recycle_bin(1)"></label>                        </div>                    </div>                    <span style="line-height: 32px; margin-left: 30px;">'+lan.files.recycle_bin_ps+'</span>                    <button style="float: right" class="btn btn-default btn-sm" onclick="bt_file.CloseRecycleBin();">'+lan.files.recycle_bin_close+'</button>                    </div>                    <div class="re-con">                        <div class="re-con-menu">                            <p class="on" data-type="1">'+lan.files.recycle_bin_type1+'</p>                            <p data-type="2">'+lan.files.recycle_bin_type2+'</p>                            <p data-type="3">'+lan.files.recycle_bin_type3+'</p>                            <p data-type="4">'+lan.files.recycle_bin_type4+'</p>                            <p data-type="5">'+lan.files.recycle_bin_type5+'</p>                            <p data-type="6">'+lan.files.recycle_bin_type6+'</p>                        </div>                        <div class="re-con-con">                            <div style="margin: 15px;" class="divtable">                                <table width="100%" class="table table-hover">                                    <thead>                                        <tr>                                            <th>'+lan.files.recycle_bin_th1+"</th>                                            <th>"+lan.files.recycle_bin_th2+"</th>                                            <th>"+lan.files.recycle_bin_th3+'</th>                                            <th width="150">'+lan.files.recycle_bin_th4+'</th>                                            <th style="text-align: right;" width="110">'+lan.files.recycle_bin_th5+'</th>                                        </tr>                                    </thead>                                    <tbody id="RecycleBody" class="list-list"></tbody>                                </table>                            </div>                        </div>                    </div>                </div>',success:function(){-1!=window.location.href.indexOf("database")?($(".re-con-menu p:last-child").addClass("on").siblings().removeClass("on"),e.render_recycle_list(6)):e.render_recycle_list(1),$(".re-con-menu").on("click","p",function(){var t=$(this).data("type");$(this).addClass("on").siblings().removeClass("on"),e.render_recycle_list(t)})}})},render_recycle_list:function(e){var t=this;this.$http("Get_Recycle_bin",function(i){function a(e){var t=e.split("."),i=t.length-1;return t=t[i],t}function l(e){for(var t=["jpg","jpeg","png","bmp","gif","tiff","ico"],i=0;i<t.length;i++)if(e==t[i])return!0;return!1}var s="";switch($("#Set_Recycle_bin").attr("checked",i.status),$("#Set_Recycle_bin_db").attr("checked",i.status_db),e){case 1:for(var n=0;n<i.dirs.length;n++){var o=i.dirs[n].name.replace(/'/,"\\'"),r=i.dirs[n].dname;o.length>20&&(o=o.substring(0,20)+"..."),r.length>20&&(r=r.substring(0,20)+"..."),s+='<tr>                          <td><span class=\'ico ico-folder\'></span><span class="tname" title="'+i.dirs[n].name+'">'+o+'</span></td>                          <td><span title="'+i.dirs[n].dname+'">'+r+"</span></td>                          <td>"+ToSize(i.dirs[n].size)+"</td>                          <td>"+getLocalTime(i.dirs[n].time)+'</td>                          <td style="text-align: right;">                              <a class="btlink" href="javascript:;" onclick="bt_file.ReRecycleBin(\''+i.dirs[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_re+'</a>                              | <a class="btlink" href="javascript:;" onclick="bt_file.DelRecycleBin(\''+i.dirs[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_del+"</a>                          </td>                        </tr>"}for(n=0;n<i.files.length;n++)if(-1==i.files[n].name.indexOf("BTDB_")){o=i.files[n].name.replace(/'/,"\\'"),r=i.files[n].dname;o.length>20&&(o=o.substring(0,20)+"..."),r.length>20&&(r=r.substring(0,20)+"..."),s+='<tr>                                    <td><span class="ico ico-'+t.get_ext_name(i.files[n].name)+'"></span><span class="tname" title="'+i.files[n].name+'">'+o+'</span></td>                                    <td><span title="'+i.files[n].dname+'">'+r+"</span></td>                                    <td>"+ToSize(i.files[n].size)+"</td>                                    <td>"+getLocalTime(i.files[n].time)+'</td>                                    <td style="text-align: right;">                                        <a class="btlink" href="javascript:;" onclick="bt_file.ReRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_re+'</a>                                        | <a class="btlink" href="javascript:;" onclick="bt_file.DelRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_del+"</a>                                    </td>                                </tr>"}else{var o=i.files[n].name.replace(/'/,"\\'"),r=i.files[n].dname;o.length>20&&(o=o.substring(0,20)+"..."),r.length>20&&(r=r.substring(0,20)+"..."),s+='<tr>                                    <td><span class="ico ico-'+t.get_ext_name(i.files[n].name)+'"></span><span class="tname" title="'+i.files[n].name+'">'+o.replace("BTDB_","")+'</span></td>                                    <td><span title="'+i.files[n].dname+'">mysql://'+r.replace("BTDB_","")+"</span></td>                                    <td>-</td>                                    <td>"+getLocalTime(i.files[n].time)+'</td>                                    <td style="text-align: right;">                                        <a class="btlink" href="javascript:;" onclick="bt_file.ReRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_re+'</a>                                        | <a class="btlink" href="javascript:;" onclick="bt_file.DelRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_del+"</a>                                    </td>                                </tr>"}return void $("#RecycleBody").html(s);case 2:for(n=0;n<i.dirs.length;n++){o=i.dirs[n].name.replace(/'/,"\\'"),r=i.dirs[n].dname;o.length>20&&(o=o.substring(0,20)+"..."),r.length>20&&(r=r.substring(0,20)+"..."),s+='<tr>                                    <td><span class=\'ico ico-folder\'></span><span class="tname" title="'+i.dirs[n].name+'">'+o+'</span></td>                                    <td><span title="'+i.dirs[n].dname+'">'+r+"</span></td>                                    <td>"+ToSize(i.dirs[n].size)+"</td>                                    <td>"+getLocalTime(i.dirs[n].time)+'</td>                                    <td style="text-align: right;">                                        <a class="btlink" href="javascript:;" onclick="bt_file.ReRecycleBin(\''+i.dirs[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_re+'</a>                                        | <a class="btlink" href="javascript:;" onclick="bt_file.DelRecycleBin(\''+i.dirs[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_del+"</a>                                    </td>                                </tr>"}return void $("#RecycleBody").html(s);case 3:for(n=0;n<i.files.length;n++)if(-1==i.files[n].name.indexOf("BTDB_")){o=i.files[n].name.replace(/'/,"\\'"),r=i.files[n].dname;o.length>20&&(o=o.substring(0,20)+"..."),r.length>20&&(r=r.substring(0,20)+"..."),s+='<tr>                                    <td><span class="ico ico-'+t.get_ext_name(i.files[n].name)+'"></span><span class="tname" title="'+i.files[n].name+'">'+o+'</span></td>                                    <td><span title="'+i.files[n].dname+'">'+r+"</span></td>                                    <td>"+ToSize(i.files[n].size)+"</td>                                    <td>"+getLocalTime(i.files[n].time)+'</td>                                    <td style="text-align: right;">                                        <a class="btlink" href="javascript:;" onclick="bt_file.ReRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_re+'</a>                                        | <a class="btlink" href="javascript:;" onclick="bt_file.DelRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_del+"</a>                                    </td>                                </tr>"}return void $("#RecycleBody").html(s);case 4:for(n=0;n<i.files.length;n++)if(l(a(i.files[n].name))){o=i.files[n].name.replace(/'/,"\\'"),r=i.files[n].dname;o.length>20&&(o=o.substring(0,20)+"..."),r.length>20&&(r=r.substring(0,20)+"..."),s+='<tr>                                    <td><span class="ico ico-'+t.get_ext_name(i.files[n].name)+'"></span><span class="tname" title="'+i.files[n].name+'">'+o+'</span></td>                                    <td><span title="'+i.files[n].dname+'">'+r+"</span></td>                                    <td>"+ToSize(i.files[n].size)+"</td>                                    <td>"+getLocalTime(i.files[n].time)+'</td>                                    <td style="text-align: right;">                                        <a class="btlink" href="javascript:;" onclick="bt_file.ReRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_re+'</a>                                        | <a class="btlink" href="javascript:;" onclick="bt_file.DelRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_del+"</a>                                    </td>                                </tr>"}return void $("#RecycleBody").html(s);case 5:for(n=0;n<i.files.length;n++)if(-1==i.files[n].name.indexOf("BTDB_")&&!l(a(i.files[n].name))){o=i.files[n].name.replace(/'/,"\\'"),r=i.files[n].dname;o.length>20&&(o=o.substring(0,20)+"..."),r.length>20&&(r=r.substring(0,20)+"..."),s+='<tr>                                    <td><span class="ico ico-'+t.get_ext_name(i.files[n].name)+'"></span><span class="tname" title="'+i.files[n].name+'">'+o+'</span></td>                                    <td><span title="'+i.files[n].dname+'">'+r+"</span></td>                                    <td>"+ToSize(i.files[n].size)+"</td>                                    <td>"+getLocalTime(i.files[n].time)+'</td>                                    <td style="text-align: right;">                                        <a class="btlink" href="javascript:;" onclick="bt_file.ReRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_re+'</a>                                        | <a class="btlink" href="javascript:;" onclick="bt_file.DelRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_del+"</a>                                    </td>                                </tr>"}return void $("#RecycleBody").html(s);case 6:for(n=0;n<i.files.length;n++)if(-1!=i.files[n].name.indexOf("BTDB_")){o=i.files[n].name.replace(/'/,"\\'"),r=i.files[n].dname;o.length>20&&(o=o.substring(0,20)+"..."),r.length>20&&(r=r.substring(0,20)+"..."),s+='<tr>                                    <td><span class="ico ico-'+t.get_ext_name(i.files[n].name)+'"></span><span class="tname" title="'+i.files[n].name+'">'+o.replace("BTDB_","")+'</span></td>                                    <td><span title="'+i.files[n].dname+'">mysql://'+r.replace("BTDB_","")+"</span></td>                                    <td>-</td>                                    <td>"+getLocalTime(i.files[n].time)+'</td>                                    <td style="text-align: right;">                                        <a class="btlink" href="javascript:;" onclick="bt_file.ReRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_re+'</a>                                        | <a class="btlink" href="javascript:;" onclick="bt_file.DelRecycleBin(\''+i.files[n].rname.replace(/'/,"\\'")+"',this)\">"+lan.files.recycle_bin_del+"</a>                                    </td>                                </tr>"}return void $("#RecycleBody").html(s)}$("#RecycleBody").html(s)})},recycle_bin_view:function(){var e=this;layer.open({title:lan.files.recycle_bin_title,type:1,skin:"recycle_view",area:["80%","672px"],closeBtn:2,content:'<div class="recycle_bin_view">              <div class="re-head">                  <div style="margin-left: 3px;" class="ss-text">                      <em>'+lan.files.recycle_bin_on+'</em>                      <div class="ssh-item">                              <input class="btswitch btswitch-ios" id="Set_Recycle_bin" type="checkbox">                              <label class="btswitch-btn" for="Set_Recycle_bin" onclick="bt_file.Set_Recycle_bin()"></label>                      </div>                      <em style="margin-left: 20px;">'+lan.files.recycle_bin_on_db+'</em>                      <div class="ssh-item">                              <input class="btswitch btswitch-ios" id="Set_Recycle_bin_db" type="checkbox">                              <label class="btswitch-btn" for="Set_Recycle_bin_db" onclick="bt_file.Set_Recycle_bin(1)"></label>                      </div>                  </div>                  <span style="line-height: 32px; margin-left: 30px;">'+lan.files.recycle_bin_ps+'</span>                  <button style="float: right" class="btn btn-default btn-sm" onclick="bt_file.CloseRecycleBin();">'+lan.files.recycle_bin_close+'</button>              </div>              <div class="re-con">                  <div class="re-con-menu">                      <p class="on" data-type="1">'+lan.files.recycle_bin_type1+'</p>                      <p data-type="2">'+lan.files.recycle_bin_type2+'</p>                      <p data-type="3">'+lan.files.recycle_bin_type3+'</p>                      <p data-type="4">'+lan.files.recycle_bin_type4+'</p>                      <p data-type="5">'+lan.files.recycle_bin_type5+'</p>                      <p data-type="6">'+lan.files.recycle_bin_type6+'</p>                  </div>                  <div class="re-con-con pd15" id="recycle_table"></div>              </div>          </div>',success:function(){-1!=window.location.href.indexOf("database")?($(".re-con-menu p:last-child").addClass("on").siblings().removeClass("on"),$(".re-con-menu p:eq(5)").click()):$(".re-con-menu p:eq(0)").click();var t=e.render_recycle_list();$(".re-con-menu").on("click","p",function(){$(this).data("type");$(this).addClass("on").siblings().removeClass("on"),t.$refresh_table_list(!0)})}})},render_recycle_list:function(){var e=this;$("#recycle_table").empty();var t=bt_tools.table({el:"#recycle_table",url:"/files?action=Get_Recycle_bin",height:480,dataFilter:function(t){var i=[];switch($(".re-con-menu p.on").index()){case 0:for(let e=0;e<t.dirs.length;e++){const a=t.dirs[e];i.push($.extend(a,{type:"folder"}))}for(let a=0;a<t.files.length;a++){const l=t.files[a],s=l.dname.split("."),n=e.determine_file_type(s[s.length-1]);l.name.indexOf("BTDB_")>-1?(l.dname=l.dname.replace("BTDB_",""),l.name=l.name.replace("BTDB_",""),i.push($.extend(l,{type:"files"}))):"images"==n?i.push($.extend(l,{type:n})):i.push($.extend(l,{type:"files"}))}break;case 1:for(let e=0;e<t.dirs.length;e++){const a=t.dirs[e];i.push($.extend(a,{type:"files"}))}break;case 2:for(let a=0;a<t.files.length;a++){const l=t.files[a],s=l.dname.split("."),n=e.determine_file_type(s[s.length-1]);-1==l.name.indexOf("BTDB")&&i.push($.extend(l,{type:n}))}break;case 3:for(let a=0;a<t.files.length;a++){const l=t.files[a],s=l.dname.split("."),n=e.determine_file_type(s[s.length-1]);"images"==n&&i.push($.extend(l,{type:n}))}break;case 4:for(let a=0;a<t.files.length;a++){const l=t.files[a],s=l.dname.split("."),n=e.determine_file_type(s[s.length-1]);"images"!=n&&"compress"!=n&&"video"!=n&&-1==l.name.indexOf("BTDB")&&i.push($.extend(l,{type:n}))}break;case 5:for(let e=0;e<t.files.length;e++){const a=t.files[e];a.name.indexOf("BTDB_")>-1&&(a.dname=a.dname.replace("BTDB_",""),a.name=a.name.replace("BTDB_",""),i.push($.extend(a,{type:"files"})))}}return $("#Set_Recycle_bin").attr("checked",t.status),$("#Set_Recycle_bin_db").attr("checked",t.status_db),{data:i}},column:[{type:"checkbox",class:"",width:18},{fid:"name",title:lan.files.recycle_bin_th1,width:155,template:function(e){return'<div class="text-overflow" style="width:150px" title="'+e.name+'"><i class="file_icon file_'+e.type+'"></i><span style="width:100px">'+e.name+"</span></div>"}},{fid:"dname",title:lan.files.recycle_bin_th2,template:function(e){return'<span class="text-overflow" style="min-width:150px" title="'+e.dname+'">'+e.dname+"</span>"}},{fid:"size",title:lan.files.recycle_bin_th3,width:85,template:function(e){return'<span class="text-overflow"  title="'+e.size+'">'+bt.format_size(e.size)+"</span>"}},{fid:"time",title:lan.files.recycle_bin_th4,width:180,template:function(e,t){return'<span title="'+e.time+'">'+bt.format_data(e.time)+"</span>"}},{type:"group",align:"right",width:250,title:lan.files.recycle_bin_th5,group:[{title:lan.files.recycle_bin_re,event:function(e,t,i,a,l){bt_file.ReRecycleBin(e.rname,function(){l.$delete_table_row(t)})}},{title:lan.files.recycle_bin_del,event:function(e,t,i,a,l){bt_file.DelRecycleBin(e.rname,function(){l.$delete_table_row(t)})}}]}],tootls:[{type:"batch",positon:["left","bottom"],placeholder:"Please Choose",buttonValue:"Execute",disabledSelectValue:"Please select the port that needs batch operation!",selectList:[{title:"Restore",url:"/files?action=Re_Recycle_bin",load:!0,param:function(e){return{path:e.rname}},callback:function(e){bt.confirm({title:"Restore files",msg:"Batch restore selected files, do you want to continue?",icon:0},function(i){layer.close(i),e.start_batch({},function(e){for(var i="",a=0;a<e.length;a++){var l=e[a];i+="<tr><td>"+l.name+'</td><td><div style="float:right;"><span style="color:'+(l.request.status?"#20a53a":"red")+'">'+(l.request.status?"Successful recovery":"Recovery failed")+"</span></div></td></tr>"}t.$batch_success_table({title:"Restore files",th:"File name",html:i}),t.$refresh_table_list(!0)})})}},{title:"Delete files permanently",url:"/files?action=Del_Recycle_bin",load:!0,param:function(e){return{path:e.rname}},callback:function(e){bt.confirm({title:"Delete selected files",msg:"Delete the selected file. The file will be completely deleted and cannot be recovered. Do you want to continue?",icon:0},function(i){layer.close(i),e.start_batch({},function(e){for(var i="",a=0;a<e.length;a++){var l=e[a];i+="<tr><td>"+l.name+'</td><td><div style="float:right;"><span style="color:'+(l.request.status?"#20a53a":"red")+'">'+(l.request.status?"Successfully deleted":"Failed to delete")+"</span></div></td></tr>"}t.$batch_success_table({title:"Delete multiple files",th:"File name",html:i}),t.$refresh_table_list(!0)})})}}]}]});return bt_tools.$fixed_table_thead("#recycle_table .divtable"),t},Set_Recycle_bin:function(e){var t=layer.msg(lan.public.the,{icon:16,time:0,shade:[.3,"#000"]}),i=this,a={};1==e&&(a={db:e}),$.post("/files?action=Recycle_bin",a,function(a){layer.close(t),a.status&&null==e&&(i.is_recycle=$("#Set_Recycle_bin").prop("checked")),layer.msg(a.msg,{icon:a.status?1:5})})},ReRecycleBin:function(e,t){layer.confirm(lan.files.recycle_bin_re_msg,{title:lan.files.recycle_bin_re_title,closeBtn:2,icon:3},function(){var i=layer.msg(lan.files.recycle_bin_re_the,{icon:16,time:0,shade:[.3,"#000"]});$.post("/files?action=Re_Recycle_bin","path="+encodeURIComponent(e),function(e){layer.close(i),layer.msg(e.msg,{icon:e.status?1:5}),$(t).parents("tr").remove()})})},DelRecycleBin:function(e,t){layer.confirm(lan.files.recycle_bin_del_msg,{title:lan.files.recycle_bin_del_title,closeBtn:2,icon:3},function(){var i=layer.msg(lan.files.recycle_bin_del_the,{icon:16,time:0,shade:[.3,"#000"]});$.post("/files?action=Del_Recycle_bin","path="+encodeURIComponent(e),function(e){layer.close(i),layer.msg(e.msg,{icon:e.status?1:5}),$(t).parents("tr").remove()})})},CloseRecycleBin:function(){var e=this;layer.confirm(lan.files.recycle_bin_close_msg,{title:lan.files.recycle_bin_close,closeBtn:2,icon:3},function(){var t=layer.msg("<div class='myspeed'>"+lan.files.recycle_bin_close_the+"</div>",{icon:16,time:0,shade:[.3,"#000"]});setTimeout(function(){getSpeed(".myspeed")},1e3),$.post("/files?action=Close_Recycle_bin","",function(i){layer.close(t),layer.msg(i.msg,{icon:i.status?1:5}),e.render_recycle_list()})})},open_property_view:function(e){var t=this;t.$http("get_file_attribute",{filename:e.path},function(i){layer.open({type:1,closeBtn:2,title:"[ "+e.filename+" ] - "+(e.is_dir?"Folder":"File")+" properties",area:["580px","500px"],shadeClose:!1,content:'<div class="bt-property-setting pd15">            <div class="tab-nav">              <span class="on">General</span>              <span>Detail</span>              <span>History</span>            </div>            <div class="tab-con">              <div class="property-box file_list_content active" style="overflow-x:hidden">                <div class="attr-box">                  <div class="attr-name" style="height: 60px;line-height: 60px;"><i class="file_icon file_'+(i.is_link?"link":i.is_dir?"folder":i.st_type)+'"></i></div>                  <div class="attr-content" style="height: 60px;line-height: 60px;"><input type="text" disabled value="'+e.filename+'" /></div>                </div>                <div class="dividing"></div>                <div class="attr-box" >                  <div class="attr-name">Type:</div>                  <div class="attr-content">'+(i.is_dir||i.is_link?i.st_type:t.ext_type_tips(i.st_type))+'</div>                </div>                <div class="attr-box" >                  <div class="attr-name">Location:</div>                  <div class="attr-content"><span title="'+i.path+'">'+i.path+'</span></div>                </div>                <div class="attr-box" >                  <div class="attr-name">Size:</div>                  <div class="attr-content">'+bt.format_size(i.st_size)+" ("+t.font_thousandth(i.st_size)+' byte)</div>                </div>                <div class="dividing"></div>                <div class="attr-box">                  <div class="attr-name">Permissions:</div>                  <div class="attr-content">'+i.mode+'</div>                </div>                <div class="attr-box">                  <div class="attr-name">Group:</div>                  <div class="attr-content">'+i.group+'</div>                </div>                <div class="attr-box">                  <div class="attr-name">User:</div>                  <div class="attr-content">'+i.user+'</div>                </div>                <div class="dividing"></div>                <div class="attr-box">                  <div class="attr-name">Visit time:</div>                  <div class="attr-content">'+bt.format_data(i.st_atime)+'</div>                </div>                <div class="attr-box">                  <div class="attr-name">Modified time:</div>                  <div class="attr-content">'+bt.format_data(i.st_mtime)+'</div>                </div>              </div>              <div class="property-box details_box_view">                <table>                  <thead><tr><th><div style="width:180px">Properties</div></th><th><div style="width:320px">Value</div></th></tr></thead>                  <tbody class="details_list"></tbody>                </table>              </div>              <div class="property-box history_box_view" >                <table>                  <thead><tr><th><div style="width:140px;">Modified time</div></th><th><div style="width:85px;">Size</div></th><th><div >MD5</div></th><th><div style="width:90px;text-align:right;">OPT</div></th></tr></thead>                  <tbody class="history_list"></tbody>                </table>              </div>            </div>          </div>',success:function(a,l){$(".bt-property-setting .tab-nav span").click(function(){var e=$(this).index();$(this).addClass("on").siblings().removeClass("on"),$(".property-box:eq("+e+")").addClass("active").siblings().removeClass("active")}),$(".history_box_view").on("click",".open_history_file",function(){var t=$(this).attr("data-time");openEditorView(0,e.path),setTimeout(function(){aceEditor.openHistoryEditorView({filename:e.path,history:t},function(){layer.close(l),$(".ace_conter_tips").show(),$(".ace_conter_tips .tips").html("Read-only file, the file is "+_item.path+", historic version [ "+bt.format_data(new Number(t))+' ]<a href="javascript:;" class="ml35 btlink" data-path="'+_item.path+'" data-history="'+t+'">Click to restore</a>')})},500)}),$(".history_box_view").on("click",".recovery_file_historys",function(){aceEditor.event_ecovery_file(this)});var s={filename:["Name",e.filename],type:["Type",i.is_dir||i.is_link?i.st_type:t.ext_type_tips(i.st_type)],path:"Location",st_size:["Size",bt.format_size(i.st_size)+" ("+t.font_thousandth(i.st_size)+" byte)"],st_atime:["Visit time",bt.format_data(i.st_atime)],st_mtime:["Modified time",bt.format_data(i.st_mtime)],st_ctime:["Metadata modification time",bt.format_data(i.st_ctime)],md5:"MD5",sha1:"sha1",user:"User",group:"Group",mode:"Permissions",st_uid:"UID",st_gid:"GID",st_nlink:"Num of inode links",st_ino:"inode node num",st_mode:"inode protection mode",st_dev:"inode resident device"},n="",o="";for(var r in s)if(Object.hasOwnProperty.call(s,r)){var c=s[r],d=$.isArray(c)?c[1]:i[r];n+='<tr><td><div style="width:180px">'+($.isArray(c)?c[0]:c)+'</div></td><td><div class="ellipsis" style="width:320px" title="'+d+'">'+d+"</div></td></tr>"}for(let t=0;t<i.history.length;t++){const a=i.history[t];o+='<tr><td><div style="width:140px;">'+bt.format_data(a.st_mtime)+'</div></td><td><div style="width:85px;">'+bt.format_size(a.st_size)+"</div></td><td><div>"+a.md5+'</div></td><td><div style="width:90px;text-align:right;"><a href="javascript:;" class="btlink open_history_file" data-time="'+a.st_mtime+'">view</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="javascript:;" class="btlink recovery_file_historys" data-history="'+a.st_mtime+'" data-path="'+e.path+'">restore</a></div></td></tr>'}""===o&&(o+='<tr><td colspan="4"><div style="text-align: center;">No historical version</div></td></tr>'),$(".details_list").html(n),$(".history_list ").html(o),t.fixed_table_thead(".details_box_view"),t.fixed_table_thead(".history_box_view ")}})})},fixed_table_thead:function(e){$(e).scroll(function(){var e=this.scrollTop;this.querySelector("thead").style.transform="translateY("+e+"px)"})},font_thousandth:function(e){var t=String(e).split(".");return t[0]=t[0].replace(new RegExp("(\\d)(?=(\\d{3})+$)","ig"),"$1,"),t.join(".")},open_images_preview:function(e){function t(e){
var t=Math.abs(l.rotate/90),i=t%2==0?l.preview_width:l.preview_height,a=t%2==0?l.preview_height:l.preview_width,s=$("#preview_images"),n={};l.init_width=l.natural_width,l.init_height=l.natural_height,l.init_width>i&&(l.init_width=i,l.init_height=parseFloat((i/l.natural_width*l.init_height).toFixed(2))),l.init_height>a&&(l.init_width=parseFloat((a/l.natural_height*l.init_width).toFixed(2)),l.init_height=a),l.current_width=parseFloat(l.init_width*l.scale),l.current_height=parseFloat(l.init_height*l.scale),l.current_left=parseFloat(((l.preview_width-l.current_width)/2).toFixed(2)),l.current_top=parseFloat(((l.preview_height-l.current_height)/2).toFixed(2)),n={width:l.current_width,height:l.current_height,top:l.current_top,left:l.current_left,display:"inline",transform:"rotate("+l.rotate+"deg)",opacity:1,transition:"all 100ms"},!1===e&&delete n.transition,s.css(n)}var i=this,a=$('<div class="preview_images_mask"><div class="preview_head"><span class="preview_title">'+e.filename+'</span><span class="preview_small hidden" title="Zoom out"><span class="glyphicon glyphicon-resize-small" aria-hidden="true"></span></span><span class="preview_full" title="Zoom in"><span class="glyphicon glyphicon-resize-full" aria-hidden="true"></span></span><span class="preview_close" title="Close preview view"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></span></div><div class="preview_body"><img id="preview_images" src="/download?filename='+e.path+'" data-index="'+e.images_id+'"></div><div class="preview_toolbar"><a href="javascript:;" title="Left rotation"><span class="glyphicon glyphicon-repeat reverse-repeat" aria-hidden="true"></span></a><a href="javascript:;" title="Right rotation"><span class="glyphicon glyphicon-repeat" aria-hidden="true"></span></a><a href="javascript:;" title="Zoom in"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></a><a href="javascript:;" title="Zoom out"><span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span></a><a href="javascript:;" title="Reset"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></a><a href="javascript:;" title="Image list"><span class="glyphicon glyphicon-list" aria-hidden="true"></span></a></div><div class="preview_cut_view"><a href="javascript:;" title="Up"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span></a><a href="javascript:;" title="Next"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span></a></div></div>'),l={natural_width:0,natural_height:0,init_width:0,init_height:0,preview_width:0,preview_height:0,current_width:0,current_height:0,current_left:0,current_top:0,rotate:0,scale:1,images_mouse:!1};if($(".preview_images_mask").length>0)return $("#preview_images").attr("src","/download?filename="+e.path),!1;$("body").css("overflow","hidden").append(a),l.preview_width=a[0].clientWidth,l.preview_height=a[0].clientHeight,$(".preview_body img").load(function(){var i=$(this)[0];$(this).attr("data-index")||$(this).attr("data-index",e.images_id),l.natural_width=i.naturalWidth,l.natural_height=i.naturalHeight,t(!1)}),$(".preview_images_mask .preview_head").on("mousedown",function(e){e=e||window.event;var t=$(this).parent();if($("body").addClass("select"),$(this).onselectstart=$(this).ondrag=function(){return!1},!$(e.target).hasClass("preview_close")){var i=e.clientX-t.offset().left,a=e.clientY-t.offset().top;$(document).on("mousemove",function(e){e=e||window.event;var l=e.clientX-i,s=e.clientY-a;l<0?l=0:l>window.innerWidth-t.width()&&(l=window.innerWidth-t.width()),s<0?s=0:s>window.innerHeight-t.height()&&(s=window.innerHeight-t.height()),t.css({left:l,top:s,margin:0})}).on("mouseup",function(){$(this).unbind("mousemove mouseup")})}}),$(".preview_images_mask #preview_images").on("mousedown",function(e){e=e||window.event,$(this).onselectstart=$(this).ondrag=function(){return!1};var t=$(this),i=$(".preview_images_mask").offset(),a=e.clientX-i.left,s=e.clientY-i.top;$(".preview_images_mask").on("mousemove",function(e){e=e||window.event;var n,o,r=e.clientX-i.left-a,c=e.clientY-i.top-s,d=Math.abs(l.rotate/90),p=d%2==0?l.preview_width:l.preview_height,_=d%2==0?l.preview_height:l.preview_width;if(l.current_width>p){var f=p-l.current_width;n=l.current_left+r,n>0?n=0:n<f&&(n=f),l.current_left=n}if(l.current_height>_){var h=_-l.current_height;o=l.current_top+c,o>0?o=0:o<h&&(o=h),l.current_top=o}l.current_height>_&&l.current_top<=0&&l.current_height-_<=l.current_top&&(l.current_top-=c),t.css({left:l.current_left,top:l.current_top})}).on("mouseup",function(){$(this).unbind("mousemove mouseup")}).on("dragstart",function(){e.preventDefault()})}).on("dragstart",function(){return!1}),$(".preview_close").click(function(e){$(".preview_images_mask").remove()}),$(".preview_toolbar a").click(function(){var e=$(this).index();$("#preview_images");switch(e){case 0:case 1:l.rotate=e?l.rotate+90:l.rotate-90,t();break;case 2:case 3:if(3==l.scale&&2==e||.2==l.scale&&3==e)return layer.msg(l.scale>=1?"The image is the maximum size":"The image is the minimum size"),!1;l.scale=(2==e?Math.round(10*(l.scale+.4)):Math.round(10*(l.scale-.4)))/10,t();break;case 4:var i=l.rotate%360;i>=180?l.rotate+=360-i:l.rotate-=i,l.scale=1,t()}}),$(".preview_full,.preview_small").click(function(){$(this).hasClass("preview_full")?($(this).addClass("hidden").prev().removeClass("hidden"),l.preview_width=i.area[0],l.preview_height=i.area[1],a.css({width:i.area[0],height:i.area[1],top:0,left:0,margin:0}).data("type","full"),t()):($(this).addClass("hidden").next().removeClass("hidden"),$(".preview_images_mask").removeAttr("style"),l.preview_width=750,l.preview_height=650,t())}),$(".preview_cut_view a").click(function(){var e="",t=$("#preview_images"),a=parseInt(t.attr("data-index"));$(this).index()?(a=a==i.file_images_list.length-1?0:a+1,e=i.file_images_list[a]):(a=0===a?i.file_images_list.length-1:a-1,e=i.file_images_list[a]),t.attr("data-index",a).attr("src","/download?filename="+e),$(".preview_title").html(i.get_path_filename(e))})},open_video_play:function(e){var t=e.path,i="/download?filename="+e.path,a=e.path.split("/"),l=a.slice(0,a.length-1).join("/");layer.open({type:1,closeBtn:2,title:'Playing [<a class="btvideo-title">'+a[a.length-1]+"</a>]",area:["890px","402px"],shadeClose:!1,skin:"movie_pay",content:'<div id="btvideo"><video type="" src="'+i+'&play=true" data-filename="'+e.path+'" controls="controls" autoplay="autoplay" width="640" height="360">            Your browser does not support video tags                        </video></div><div class="video-list"></div>',success:function(){$.post("/files?action=get_videos",{path:l},function(e){for(var i='<table class="table table-hover" style="margin-bottom:0;"><thead style="display: none;"><tr><th style="word-break: break-all;word-wrap:break-word;width:165px;">File name</th><th style="width:65px" style="text-align:right;">Size</th></tr></thead>',a=0,s=0;s<e.length;s++){var n=l+"/"+e[s].name;n===t&&(a=s),i+='<tr class="'+(n===t?"video-avt":"")+'"><td style="word-break: break-all;word-wrap:break-word;width:150px" onclick="bt_file.play_file(this,\''+n+'\')" title="Size: '+n+"\nType: "+e[s].type+'"><a>'+e[s].name+'</a></td><td style="font-size: 8px;text-align:right;width:'+(65+bt_file.scroll_width)+'px;">'+ToSize(e[s].size)+"</td></tr>"}i+="</table>",$(".video-list").html(i).scrollTop(34*a)})}})},play_file:function(e,t){if($("#btvideo video").attr("data-filename")==t)return!1;var i="/download?filename="+t+"&play=true",a='<video src="'+i+'" controls="controls" data-fileName="'+t+'" autoplay="autoplay" width="640" height="360">Your browser does not support the [video] tag.</video>';$("#btvideo").html(a);var l=t.split("/");$(".btvideo-title").html(l[l.length-1]),$(".video-avt").removeClass("video-avt"),$(e).parents("tr").addClass("video-avt")},copy_file_or_dir:function(e){bt.set_cookie("record_paste",e.path),bt.set_cookie("record_paste_type","copy"),$(".file_all_paste").removeClass("hide"),layer.msg("Copy successfully. Please click [Paste] or Ctrl + V to paste")},cut_file_or_dir:function(e){bt.set_cookie("record_paste",e.path),bt.set_cookie("record_paste_type","cut"),$(".file_all_paste").removeClass("hide"),layer.msg("Cut successfully. Please click [Paste] or Ctrl + V to paste")},paste_file_or_dir:function(){var e=this,t=bt.get_cookie("record_paste_type"),i=bt.get_cookie("record_paste"),a="";if("null"!=i&&null!=i&&(a=i.split("/").pop()),e.file_path.indexOf(i)>-1)return layer.msg("Can not paste ["+a+"] here, Because the item cannot be pasted into itself.",{icon:0}),!1;if("null"!=t&&null!=t)switch(t){case"cut":case"copy":this.check_exists_files_req({dfile:this.file_path,filename:a},function(t){if(t.length>0){for(var l="",s=0;s<t.length;s++)l+='<tr><td><span class="exists_files_style">'+t[s].filename+"</span></td><td>"+ToSize(t[s].size)+"</td><td>"+getLocalTime(t[s].mtime)+"</td></tr>";var n='<div class="divtable"><table class="table table-hover" width="100%" border="0" cellpadding="0" cellspacing="0"><thead><th>File name</th><th>Size</th><th>Last edit time</th></thead>                                        <tbody>'+l+"</tbody>                                        </table></div>";SafeMessage("This files will be overwritten",n,function(){e.config_paste_to(i,a)})}else e.config_paste_to(i,a)});break;case"1":case"2":e.batch_file_paste()}},config_paste_to:function(e,t){var i=this,a=bt.get_cookie("record_paste_type");this.$http("copy"==a?"CopyFile":"MvFile",{sfile:e,dfile:this.file_path+"/"+t},function(e){e.status&&(bt.set_cookie("record_paste",null),bt.set_cookie("record_paste_type",null),i.reader_file_list({path:i.file_path})),layer.msg(e.msg,{icon:e.status?1:2})})},rename_file_or_dir:function(e){var t=this;t.is_editor=!0,$(".file_list_content .file_tr:nth-child("+(e.index+1)+")").addClass("editr_tr").find(".file_title").empty().append($("icon"==bt.get_cookie("rank")?'<textarea name="rename_file_input" onfocus="this.select()">'+e.filename+"</textarea>":'<input name="rename_file_input" onfocus="this.select()" type="text" value="'+e.filename+'">')),"icon"==bt.get_cookie("rank")&&$("textarea[name=rename_file_input]").css({height:$("textarea[name=rename_file_input]")[0].scrollHeight}),$(("icon"==bt.get_cookie("rank")?"textarea":"input")+"[name=rename_file_input]").on("input",function(){if("icon"==bt.get_cookie("rank")&&(this.style.height="auto",this.style.height=this.scrollHeight+"px"),"file"==e.type){var t=$(this).val().split("."),i=t[t.length-1];$(this).parent().prev().find(".file_icon").removeAttr("class").addClass("file_icon file_"+i)}}).keyup(function(e){13==e.keyCode&&$(this).blur(),e.stopPropagation(),e.preventDefault()}).blur(function(){var i=$(this).val().replace(/[\r\n]/g,""),a={sfile:e.path,dfile:t.path_resolve(t.file_path,i)};return e.filename==i||""==i?($(".file_list_content .file_tr:nth-child("+(e.index+1)+")").removeClass("editr_tr").find(".file_title").empty().append($("<i>"+e.filename+"</i>")),t.is_editor=!1,!1):t.match_unqualified_string(i)?layer.msg('The name cannot have /\\:*?"<>| symbol',{icon:2}):(t.rename_file_req(a,function(e){t.reader_file_list({path:t.file_path},function(){layer.msg(e.msg,{icon:e.status?1:2})})}),void(t.is_editor=!1))}).focus()},set_file_share:function(e){var t=this;this.loadY=bt.open({type:1,shift:5,closeBtn:2,area:"450px",title:"Set share "+e.type_tips+"-["+e.filename+"]",btn:["Create","Cancel"],content:'<from class="bt-form" id="outer_url_form" style="padding:30px 15px;display:inline-block"><div class="line"><span class="tname">Share name</span><div class="info-r"><input name="ps"  class="bt-input-text mr5" type="text" placeholder="No sharing name" style="width:270px" value="'+e.filename+'"></div></div><div class="line"><span class="tname">Expiration date</span><div class="info-r"><label class="checkbox_grourd"><input type="radio" name="expire" value="24" checked><span>&nbsp;A Day</span></label><label class="checkbox_grourd"><input type="radio" name="expire" value="168"><span>&nbsp;A Deek</span></label><label class="checkbox_grourd"><input type="radio" name="expire" value="1130800"><span>&nbsp;Permanent</span></label></div></div><div class="line"><span class="tname">Extraction code</span><div class="info-r"><input name="password" class="bt-input-text mr5" placeholder="No code if it is empty" type="text" style="width:195px" value=""><button type="button" id="random_paw" class="btn btn-success btn-sm btn-title">Random</button></div></div></from>',yes:function(i,a){var l=$("[name=ps]").val(),s=$("[name=expire]:checked").val(),n=$("[name=password]").val();if(""===l)return layer.msg("No sharing name!",{icon:2}),!1;t.create_download_url({filename:e.path,ps:l,password:n,expire:s},function(i){if(!i.status)return layer.msg(i.msg,{icon:i.status?1:2}),!1;var a=i.msg;t.file_list[e.index]=$.extend(t.file_list[e.index],{down_id:a.id,down_info:a}),t.loadY.close(),t.info_file_share(e),t.reader_file_list_content(t.file_list)})},success:function(e,t){$("#random_paw").click(function(){$(this).prev().val(bt.get_random(6))})}})},info_file_share:function(e){var t=this;if(void 0===e.down_info)return this.get_download_url_find({id:e.down_id},function(i){t.file_list[e.index]=$.extend(t.file_list[e.index],{down_info:i}),t.file_share_view(t.file_list[e.index],"fonticon")}),!1;this.file_share_view(e,"fonticon")},file_share_view:function(e,t){var i=e;"fonticon"==t&&(i=e.down_info);var a=this,l=location.origin+"/down/"+i.token;this.loadY=bt.open({type:1,shift:5,closeBtn:2,area:"550px",title:"Share details-["+i.filename+"]",content:'<div class="bt-form pd20 pb70"><div class="line"><span class="tname">Share name</span><div class="info-r"><input readonly class="bt-input-text mr5" type="text" style="width:365px" value="'+i.ps+'"></div></div><div class="line external_link"><span class="tname">Share chain</span><div class="info-r"><input readonly class="bt-input-text mr5" type="text" style="width:280px" value="'+l+'"><button type="button" id="copy_url" data-clipboard-text="'+l+'" class="btn btn-success btn-sm btn-title copy_url" style="margin-right:5px" data-clipboard-target="#copy_url"><img style="width:16px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABIUlEQVQ4T6XTsSuFURjH8d+3/AFm0x0MyqBEUQaUIqUU3YwWyqgMptud/BlMSt1SBiklg0K3bhmUQTFZDZTxpyOvznt7z3sG7/T2vOf5vM85z3nQPx+KfNuHkhoZ7xXYjNfEwIukXUnvNcg2sJECnoHhugpsnwBN21PAXVgbV/AEjNhuVSFA23YHWLNt4Cc3Bh6BUdtLcbzAgHPbp8BqCngAxjJbOANWUkAPGA8fE8icpD1gOQV0gclMBRfAYgq4BaZtz/YhA5IGgY7tS2AhBdwAM7b3JX1I+iz1G45sXwHzKeAa6P97qZgcEA6v/ZsR3v9aHCmt0P9UBVuShjKz8CYpXPkDYKJ0kaKhWpe0UwOFxDATx5VACFZ0Ivbuga8i8A3NFqQRZ5pz7wAAAABJRU5ErkJggg=="></button><button type="button" class="btn btn-success QR_code btn-sm btn-title"><img  style="width:16px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABUklEQVQ4T6WSIU9DQRCEvwlYLIoEgwEECs3rDyCpobbtL6AKRyggMQ9TJBjUMzgMCeUnIEAREoICFAoEZMk2dy/Xo4KGNZu7nZ2bnT3xz1DsN7MFYCnhe5V0n/Kb2QowL2kY70cEoXAHVEnDG/ABXAJXmVDHVZKqSFAA58AqsAY8AW3A68/AQ7hbBG6BbeDGlaQEh8AucA3suzDgC5gFXHID2At5YxJBNwA6ocFBM8B3OL8DTaCcpMDN2QojxHHdk9Qrx9SeAyf1CMFIJ3DjYqxLOgo192gs4ibSNfrMOaj2yBvMrCnpImYHR4C/vizpIPkX/mpbUtfMepJKMxtKKsyslNTLCZxkBzgFjoE5oCVp08yKvyhwgkGyRl9nX1LDzDz3kzxS8kuBpFYygq8xJ4gjjBMEpz+BF+AxcXLg39XMOpLOciW1gtz9ac71GqdpSrE/8U20EQ3XLHEAAAAASUVORK5CYII="></button></div></div><div class="line external_link" style="'+(""==i.password?"display:none;":"display:block")+'"><span class="tname">Extraction code</span><div class="info-r"><input readonly class="bt-input-text mr5" type="text" style="width:243px" value="'+i.password+'"><button type="button" data-clipboard-text="Chain:'+l+" Extraction code:"+i.password+'"  class="btn btn-success copy_paw btn-sm btn-title">Copy link and code</button></div></div><div class="line"><span class="tname">Expiration date</span><div class="info-r"><span style="line-height:32px; display: block;font-size:14px">'+(i.expire>new Date("2099-01-01 00:00:00").getTime()/1e3?'<span calss="btlink">Permanent</span>':bt.format_data(i.expire))+'</span></div></div><div class="bt-form-submit-btn"><button type="button" class="btn btn-danger btn-sm btn-title layer_close">'+lan.public.close+'</button><button type="button" id="down_del" class="btn btn-danger btn-sm btn-title close_down" style="color:#fff;background-color:#c9302c;border-color:#ac2925;" onclick="">Close sharing chain</button></div></div>',success:function(s,n){var o=new ClipboardJS(".copy_url"),r=new ClipboardJS(".copy_paw");o.on("success",function(e){layer.msg("Copy link succeeded!",{icon:1}),e.clearSelection()}),r.on("success",function(e){layer.msg("Copy link and extraction code succeeded!",{icon:1}),e.clearSelection()}),$(".layer_close").click(function(){layer.close(n)}),$(".QR_code").click(function(){layer.closeAll("tips"),layer.tips('<div style="height:140px;width:140px;padding:8px 0" id="QR_code"></div>',".QR_code",{area:["150px","150px"],tips:[1,"#ececec"],time:0,shade:[.05,"#000"],shadeClose:!0,success:function(){jQuery("#QR_code").qrcode({render:"canvas",text:l,height:130,width:130})}})}),$(".close_down").click(function(){a.remove_download_url({id:i.id,fileName:i.filename},function(i){a.loadY.close(),"fonticon"==t&&(a.file_list[e.index].down_id=0,a.reader_file_list_content(a.file_list)),"list"==t&&a.render_share_list(),layer.msg(i.msg,{icon:i.status?1:2})})})}})},del_file_or_dir:function(e){var t=this;t.is_recycle?bt.confirm({title:"Delete "+e.type_tips+"[&nbsp;"+e.filename+"&nbsp;]",msg:"<span>Comfirm delete "+e.type_tips+"[&nbsp;"+e.path+"&nbsp;],it will move to recycle bin after delete, continue?</span>"},function(){t.del_file_req(e,function(e){t.reader_file_list({path:t.file_path}),layer.msg(e.msg,{icon:e.status?1:2})})}):bt.show_confirm("Delete "+e.type_tips+"[&nbsp;"+e.filename+"&nbsp;]",'<i style="font-size: 15px;font-style: initial;color: red;">Recycle bin is not currently open, delete '+("dir"==e.type?"directory":"file")+" cannot be restored after, continue?</i></span>",function(){t.del_file_req(e,function(e){t.reader_file_list({path:t.file_path}),layer.msg(e.msg,{icon:e.status?1:2})})})},cancel_file_favorites:function(e){var t=this,i=e.index;this.loadY=bt.confirm({title:e.filename+lan.files.unfavorite1,msg:lan.files.unfavorite1+" ["+e.path+"] "+lan.files.continue},function(){t.$http("del_files_store",{path:e.path},function(e){e.status&&(t.file_list[i].caret=!1,t.reader_file_list_content(t.file_list),t.load_favorites_index_list()),layer.msg(e.msg,{icon:e.status?1:2})})})},set_soft_link:function(e){var t=this;bt_tools.open({title:"Create Softlink",area:"520px",content:{class:"pd20",formLabelWidth:"110px",form:[{label:"Source file",group:{type:"text",name:"sfile",width:"280px",placeholder:"Please select the folder and file to be linked",icon:{type:"glyphicon-folder-open",event:function(e){},select:"all"},value:"",input:function(e){}}},{label:"Softlink name",group:{type:"text",name:"name",width:"280px",placeholder:"Please enter the name of the softlink",value:""}}]},init:function(){var e=null,t=setInterval(function(){if($('input[name="sfile"]').length<1&&clearInterval(t),e!=$('input[name="sfile"]').val()){e=$('input[name="sfile"]').val();var i=e.split("/");i.length>1&&$('[name="name"]').val(i[i.length-1])}},100)},yes:function(e,i,a){e=$.extend(e,{dfile:t.file_path+"/"+e.name}),delete e.name,bt_tools.send("files/CreateLink",e,function(e){e.status&&(layer.close(i),bt.msg(e),t.reader_file_list())},{tips:"Create Softlink"})}})},set_file_authority:function(e,t){var i=this;i.get_file_authority({path:e.path},function(a){var l='<div class="info-title-tips" style="padding-left: 7px;margin: 10px 23px;">                <span class="glyphicon glyphicon-alert" style="color: #f39c12; margin-right: 5px;"></span>                <span class="backuptip"></span>                <button class="restore btn btn-success btn-sm" style="margin-left: 5px;">Backup</button>                <div style="display: inline-block;width: 1px;height: 13px;background: #20a53a;vertical-align: middle;margin: 0 5px;"></div>                <button class="manage btn btn-default btn-sm tolist" style="padding:6px;">Restore</button>            </div>';i.loadY=layer.open({type:1,closeBtn:2,title:lan.files.set_auth+"["+e.filename+"]",area:"465px",shadeClose:!1,content:'<div class="setchmod bt-form" style="padding: 0;">                            <div class="bt_tab_list">                                <div class="bt_tab_index active" data-index="0">Set permission</div>                                <div class="bt_tab_index backup-list" data-index="1">Backups list</div>                            </div>                            <div class="chmodset" style="margin-bottom: 60px;">'+l+"                                <fieldset>                                    <legend>"+lan.files.file_own+'</legend>                                    <p><input type="checkbox" id="owner_r" />'+lan.files.file_read+'</p>                                    <p><input type="checkbox" id="owner_w" />'+lan.files.file_write+'</p>                                    <p><input type="checkbox" id="owner_x" />'+lan.files.file_exec+"</p>                                </fieldset>                                <fieldset>                                    <legend>"+lan.files.file_group+'</legend>                                    <p><input type="checkbox" id="group_r" />'+lan.files.file_read+'</p>                                    <p><input type="checkbox" id="group_w" />'+lan.files.file_write+'</p>                                    <p><input type="checkbox" id="group_x" />'+lan.files.file_exec+"</p>                                </fieldset>                                <fieldset>                                    <legend>"+lan.files.file_public+'</legend>                                    <p><input type="checkbox" id="public_r" />'+lan.files.file_read+'</p>                                    <p><input type="checkbox" id="public_w" />'+lan.files.file_write+'</p>                                    <p><input type="checkbox" id="public_x" />'+lan.files.file_exec+'</p>                                </fieldset>                                <div class="setchmodnum"><input class="bt-input-text" type="text" id="access" maxlength="3" value="'+a.chmod+'">'+lan.files.file_menu_auth+"，                                <span>"+lan.files.file_own+'                                <select id="chown" class="bt-input-text">                                    <option value="www" '+("www"==a.chown?'selected="selected"':"")+'>www</option>                                    <option value="mysql" '+("mysql"==a.chown?'selected="selected"':"")+'>mysql</option>                                    <option value="root" '+("root"==a.chown?'selected="selected"':"")+'>root</option>                                </select></span>                                <span><input type="checkbox" id="accept_all" checked /><label for="accept_all" style="position: absolute;margin-top: 4px; margin-left: 5px;font-weight: 400;">Apply to subdir</label></span>                                </div>                            </div>                            <div class="backup_lists"></div>                            <div class="bt-form-submit-btn">                                <button type="button" class="btn btn-danger btn-sm btn-title layer_close">'+lan.public.close+'</button>                                <button type="button" class="btn btn-success btn-sm btn-title set_access_authority">'+lan.public.ok+"</button>                            </div>                        </div>",success:function(a,l){i.edit_access_authority(),$("#access").keyup(function(){i.edit_access_authority()}),$("input[type=checkbox]").change(function(){for(var e=["owner","group","public"],t="",i=0;i<e.length;i++){var a=0;a+=$("#"+e[i]+"_x").prop("checked")?1:0,a+=$("#"+e[i]+"_w").prop("checked")?2:0,a+=$("#"+e[i]+"_r").prop("checked")?4:0,t+=a}$("#access").val(t)}),$(".set_access_authority").click(function(){var a=$("#access").val(),s=$("#chown").val(),n=$("#accept_all").prop("checked")?"True":"False",o={};o={user:s,access:a,all:n},t?(o.type=e.type,o.path=e.path,o.data=e.filelist):o.filename=e.path,i.$http(t?"SetBatchData":"SetFileAccess",o,function(e){e.status&&(layer.close(l),i.reader_file_list({path:i.file_path,is_operating:!1})),layer.msg(e.msg,{icon:e.status?1:2})})}),$(".layer_close").click(function(){layer.close(l)}),i.$http("get_path_premissions",{path:e.filename},function(e){0==e.length&&$(".backuptip").text("No backup")}),$("button.restore").click(function(){i.backup_files_permission(e.path,1)}),$(".tolist").click(function(){$(".backup-list").click()}),$(".bt_tab_list .bt_tab_index").click(function(){$(this).addClass("active").siblings().removeClass("active"),0==$(this).index()?($(".backup_lists").empty(),$(".chmodset").show()):i.backup_files_list(e.path)})}})})},backup_files_permission:function(e,t){var i=1;1==t&&(i=$("#accept_all").prop("checked")?1:0);var a=this,l=layer.open({type:1,closeBtn:2,title:"Confirm backup?",area:"300px",shadeClose:!1,btn:["Yes","No"],content:'<div style="padding: 20px;margin: 0;font-size: 13px;">                            <p style="padding: 8px 5px;font-size: 13px;">Please enter the current backup name</p>                            <div>Remarks                                <input type="text" class="form-control ml5 mt10" placeholder="Please enter name" style="width: 179px;display: inline-block;">                            </div>                        </div>',yes:function(l,s){$(".layer_close").click(function(){layer.close(s)}),a.$http("back_path_permissions",{back_sub_dir:i,path:e,remark:$("input.form-control").val()},function(i){if(layer.close(l),!i.status)return layer.msg(i.msg,{time:1900,icon:2}),!1;if(0==t){var s=a.backup_list();$(".buplist").html(s)}else if(3==t){var n=$("#access").val(),o=$("#chown").val(),r=$("#accept_all").prop("checked")?"True":"False",c="filename="+encodeURIComponent(e)+"&user="+o+"&access="+n+"&all="+r;Oksend(c),layer.closeAll()}layer.msg(i.msg,{time:1900,icon:1})})},btn2:function(){layer.close(l)},cancel:function(){layer.close(l)}})},backup_list:function(){var e="",t=this;t.$http("get_all_back",function(t){for(var i=0;i<t.length;i++){var a=new Date(1e3*t[i][2]),l=a.getMinutes(),s=a.getHours(),n=a.getSeconds();l<=9&&(l="0"+l),s<=9&&(s="0"+s),n<=9&&(n="0"+n);var o=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" "+s+":"+l+":"+n;e+='<tr style="padding: 5px;margin: 0;border: #e6e6e6 1px solid;border-top: none;" data-id="'+t[i][0]+'">                    <td>'+o+'</td>                    <td style="max-width: 297px;min-width: 297px;">                        <a style="width: 287px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;display: inline-block;" class="btlink"  title="'+t[i][3]+'" href="javascript:openPath(\''+t[i][3]+"');\">"+t[i][3]+'</a>                    </td>                    <td style="max-width: 77px;min-width: 77px;overflow: hidden;text-overflow: ellipsis;text-align: left;" title="'+t[i][1]+'">'+t[i][1]+'</td>                    <td style="min-width: 60px;text-align: center;"><a class="btlink del_back">Del</a></td>                </tr>'}$(".allback .buplist").html(e)})},manage_backup:function(){var e=this,t=layer.open({type:1,closeBtn:2,title:"Manage Backups",area:["630px","500px"],shadeClose:!1,content:'<div class="allback pd20" style="padding-bottom: 0;">                        <div class="info-r c4 mb15 text-left relative">                            <input class="bt-input-text" id="server_path" type="text" name="path" placeholder="Please select the project path" style="width:75%;">                            <div style="display: inline-block;position: absolute;right:0;text-align: right;">                                <span data-id="path" class="glyphicon cursor glyphicon-folder-open" style="margin-right: 31px;" onclick="ChangePath(\'server_path\',\'dir\')"></span>                                <button class="btn btn-success btn-sm btn-backup" id="btn-backup">Backup</button>                            </div>                        </div>                        <table class="text-left table table-hover" style="margin-bottom: 0;">                            <thead style="background: #f6f6f6;margin: 0;border: #e6e6e6 1px solid;border-bottom: none;">                                <tr>                                    <th style="color: #666;font-weight: 600;padding: 10px 8px;width: 151px;border-bottom: none;">Backup time</th>                                    <th style="color: #666;font-weight: 600;padding: 10px 8px;width: 290px;border-bottom: none;">Backup path</th>                                    <th style="color: #666;font-weight: 600;padding: 10px 8px;text-align: center;border-bottom: none;">Name</th>                                    <th style="color: #666;font-weight: 600;padding: 10px 8px;text-align: center;border-bottom: none;">Delect</th>                                </tr>                            </thead>                        </table>                        <div style="height: 337px;overflow: auto;">                            <table class="text-left table table-hover">                                <tbody class="buplist"></tbody>                            </table>                        </div>                    </div>',cancel:function(){layer.close(t)},success:function(){e.backup_list(),$("#btn-backup").click(function(t){var i=$("#server_path").val();e.backup_files_permission(i,0)}),$(".allback").on("click",".del_back",function(){var t=$(this).parents("tr").attr("data-id");e.del_backup(t)})}})},del_backup:function(e){var t=this;layer.confirm("The backup cannot be restored after deletion.<br>Continue to delete?",{title:"Confirm delete？",btn:["Yes","No"],closeBtn:2},function(i,a){t.$http("del_path_premissions",{id:e},function(i){var a=$(".layui-layer-title:eq(0)").text();"Manage Backups"!==a?(a=$(".backup_list").attr("data-path"),t.backup_files_list(a)):$(".allback tbody tr[data-id="+e+"]").remove(),layer.msg(i.msg,{icon:i.status?1:2})})})},backup_files_list:function(e){var t=this;t.$http("get_path_premissions",{path:e},function(i){var a="",l="";if(0==i.length)a='<tr><td colspan="5" align="center">No data</td></tr>';else for(var s=0;s<i.length;s++){var n=new Date(1e3*i[s][3]),o=n.getMinutes(),r=n.getHours();o<=9&&(o="0"+o),r<=9&&(r="0"+r);var c=n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate();a+='<tr>                        <td><span style="display: inline-block;width: 60px; overflow: hidden;text-overflow: ellipsis;">'+i[s][4]+"</span></td>                        <td>"+i[s][2]+"</td>                        <td>"+i[s][1]+"</td>                        <td>"+c+'</td>                        <td style="color: #666;text-align: right;"><a data-time="'+i[s][3]+'" class="btlink restore_backup">Restore</a> | <a data-id="'+i[s][5]+'" class="btlink del_back">Del</a></td>                    </tr>'}
l='<div class="divtable" style="height: 260px; overflow: auto;padding:11px 13px 3px;">                <div class="info-title-tips" style="text-align:left;margin-bottom: 7px;">                    <span class="glyphicon glyphicon-alert" style="color: #f39c12; margin-right: 5px;"></span>                    <span>Fix all permissions to [ Folder: 755, File: 644 ]</span>                    <button class="manage btn btn-default btn-sm btn-success fixper" style="padding:6px;margin-left: 7px;">Fix permissions</button>                </div>                <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table table-hover">                    <thead>                        <tr>                            <th width="60">Name</th>                            <th width="35">permission</th>                            <th width="45">Owner</th>                            <th>Backup Time</th>                            <th style="text-align: right;">Opt</th>                        </tr>                    </thead>                    <tbody class="backup_list" data-path="'+e+'">                        '+a+"                    </tbody>                </table>            </div>",$(".chmodset").hide(),$(".backup_lists").html(l),$(".fixper").click(function(){layer.confirm("Note: Under the file or folder all permissions will be fixed to [ Folder: 755, File: 644 ]",{title:"Fix Permissions？",btn:["Confirm","Cancel"],closeBtn:2},function(i,a){t.$http("fix_permissions",{path:e},function(e){layer.closeAll(),t.reader_file_list({path:t.file_path,is_operating:!1}),layer.msg(e.msg,{icon:e.status?1:2})})})}),$(".restore_backup").click(function(){t.restore_file_permission($(this).attr("data-time"),e)}),$(".backup_list").on("click",".del_back",function(){var e=$(this).attr("data-id");t.del_backup(e)})})},restore_file_permission:function(e,t){var i=this,a=$("#accept_all").prop("checked")?1:0,l=layer.open({type:1,closeBtn:2,title:"Confirm restore",area:"330px",shadeClose:!1,btn:["Yes","No"],content:'<div style="padding: 20px;font-size: 14px;">                        Restore would overwrite the current settings, continue?                    </div>',yes:function(l,s){i.$http("restore_path_permissions",{restore_sub_dir:a,date:e,path:t},function(e){layer.closeAll(),layer.msg(e.msg,{icon:1,time:1900})})},btn2:function(){layer.close(l)},cancel:function(){layer.close(l)}})},get_present_task_view:function(){this.file_present_task=layer.open({type:1,title:"Real-time task queue",area:"500px",closeBtn:2,skin:"present_task_list",shadeClose:!1,shade:!1,offset:"auto",content:'<div style="margin: 10px;" class="message-list"></div>'})},render_present_task_list:function(){var e=this;this.get_task_req({status:-3},function(t){if(0==t.length)return layer.close(e.file_present_task),e.file_present_task=null,void e.reader_file_list({path:e.file_path,is_operating:!1});var i="",a=!1;$.each(t,function(t,l){-1==l.status?(e.file_present_task||e.get_present_task_view(),"1"==l.type?i+='<div class="mw-con">                            <ul class="waiting-down-list">                                <li>                                    <div class="down-filse-name"><span class="fname" style="width:80%;" title="'+lan.layout.download+l.shell+'">'+lan.layout.download+l.shell+'</span><span style="position: absolute;left: 84%;top: 25px;color: #999;">'+l.log.pre+'%</span><span class="btlink" onclick="bt_file.remove_present_task('+l.id+')" style="position: absolute;top: 25px;right: 20px;">'+lan.public.cancel+'</span></div>                                    <div class="down-progress"><div class="done-progress" style="width:'+l.log.pre+'%"></div></div>                                    <div class="down-info"><span class="total-size"> '+l.log.used+"/"+ToSize(l.log.total)+'</span><span class="speed-size">'+(0==l.log.speed?lan.layout.connect:l.log.speed)+'/s</span><span style="margin-left: 20px;">'+lan.files.expected_to_be+": "+l.log.time+"</span></div>                                </li>                            </ul>                            </div>":i+='<div class="mw-title"><span style="max-width: 88%;display: block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">'+l.name+": "+l.shell+'</span><span class="btlink" onclick="bt_file.remove_present_task('+l.id+')"  style="position: absolute;top: 10px;right: 15px;">'+lan.public.cancel+'</span></div>                        <div class="mw-con codebg">                            <code>'+l.log+"</code>                        </div>"):(a||(i+='<div class="mw-title">'+lan.layout.wait_task+'</div><div class="mw-con"><ul class="waiting-list">',a=!0),i+='<li><span class="wt-list-name" style="width: 90%;">'+l.name+": "+l.shell+'</span><span class="mw-cancel" onclick="bt_file.remove_present_task('+l.id+')">X</span></li>')}),e.file_present_task&&(a&&(i+="</ul></div>"),$(".message-list").html(i)),setTimeout(function(){e.render_present_task_list()},1e3)})},remove_present_task:function(e){var t=this;layer.confirm("Do you want to cancel the upload of files? It need to delete the uploaded files manually. Continue?",{title:"Cancel file upload",icon:0},function(i){bt.send("remove_task","task/remove_task",{id:e},function(e){layer.msg(e.msg,{icon:1}),layer.close(t.file_present_task),t.file_present_task=null}),layer.close(i)})},edit_access_authority:function(){for(var e=$("#access").val(),t=["owner","group","public"],i=0;i<t.length;i++)$("#"+t[i]+"_x").prop("checked",!1),$("#"+t[i]+"_w").prop("checked",!1),$("#"+t[i]+"_r").prop("checked",!1);for(var a=0;a<e.length;a++){var l=e.substr(a,1);if(!(a>t.length))switch(l>7&&$("#access").val(e.substr(0,e.length-1)),l){case"1":$("#"+t[a]+"_x").prop("checked",!0);break;case"2":$("#"+t[a]+"_w").prop("checked",!0);break;case"3":$("#"+t[a]+"_x").prop("checked",!0),$("#"+t[a]+"_w").prop("checked",!0);break;case"4":$("#"+t[a]+"_r").prop("checked",!0);break;case"5":$("#"+t[a]+"_r").prop("checked",!0),$("#"+t[a]+"_x").prop("checked",!0);break;case"6":$("#"+t[a]+"_r").prop("checked",!0),$("#"+t[a]+"_w").prop("checked",!0);break;case"7":$("#"+t[a]+"_r").prop("checked",!0),$("#"+t[a]+"_w").prop("checked",!0),$("#"+t[a]+"_x").prop("checked",!0)}}},get_file_authority:function(e,t){this.$http("GetFileAccess",{filename:e.path},function(e){t&&t(e)})},set_dir_kill:function(e){var t=this;"php"==e.ext?t.$http("file_webshell_check",{filename:e.path},function(e){layer.msg(e.msg,{icon:e.status?1:2})}):layer.confirm("目录查杀将包含子目录中的php文件，是否操作？",{title:"目录查杀["+e.filename+"]",closeBtn:2,icon:3},function(i){t.$http("dir_webshell_check",{path:e.path},function(e){layer.msg(e.msg,{icon:e.status?1:2})})})},path_resolve:function(e,t){var i="";return Array.isArray(t)||(t=[t]),e.replace(/([\/|\/]*)$/,function(e){return e,"www"}),$.each(t,function(e,t){i+="/"+t}),(e+i).replace("//","/")},get_ext_name:function(e){for(var t=e.split("."),i=["folder","folder-unempty","sql","c","cpp","cs","flv","css","js","htm","html","java","log","mht","php","url","xml","ai","bmp","cdr","gif","ico","jpeg","jpg","JPG","png","psd","webp","ape","avi","mkv","mov","mp3","mp4","mpeg","mpg","rm","rmvb","swf","wav","webm","wma","wmv","rtf","docx","fdf","potm","pptx","txt","xlsb","xlsx","7z","cab","iso","rar","zip","gz","bt","file","apk","bookfolder","folder-empty","fromchromefolder","documentfolder","fromphonefolder","mix","musicfolder","picturefolder","videofolder","sefolder","access","mdb","accdb","fla","doc","docm","dotx","dotm","dot","pdf","ppt","pptm","pot","xls","csv","xlsm"],a=t[t.length-1],l=0;l<i.length;l++)if(i[l]==a)return i[l];return"file"},get_path_filename:function(e){var t=e.split("/");return t[t.length-1]},retrun_prev_path:function(e){var t=e.split("/");return t.splice(t.length-1),""==t&&(t=["/"]),t.join("/")},path_check:function(e){return e=e.replace("//","/"),"/"===e?e:(e=e.replace(/\/+$/g,""),e)},get_file_access:function(e,t){var i=this;this.layerT=bt.load("Getting file permissions, please wait..."),bt.send("GetFileAccess","files/GetFileAccess",{path:e.path},function(e){i.loadT.close(),t&&t()})},create_download_url:function(e,t){var i=this;this.layerT=bt.load("sharing file, please wait..."),bt.send("create_download_url","files/create_download_url",{filename:e.filename,ps:e.ps,password:e.password,expire:e.expire},function(e){i.layerT.close(),t&&t(e)})},get_download_url_find:function(e,t){var i=this;this.layerT=bt.load("Getting sharing file datals, please wait..."),bt.send("get_download_url_find","files/get_download_url_find",{id:e.id},function(e){i.layerT.close(),t&&t(e)})},remove_download_url:function(e,t){layer.confirm("Comfirm to stop sharing【"+e.fileName+"】, continue?",{title:"Cancel sharing",closeBtn:2,icon:3},function(){this.layerT=bt.load("Canceling sharing files, please wait..."),bt.send("remove_download_url","files/remove_download_url",{id:e.id},function(e){t&&t(e)})})},get_disk_list:function(e){bt_tools.send("system/GetDiskInfo",function(t){e&&e(t)},"Getting disk list, please wait...")},create_file_req:function(e,t){var i="folder"===e.type?"CreateDir":"CreateFile";bt.send(i,"files/"+i,{path:e.path},function(e){t&&t(e)})},rename_file_req:function(e,t){bt_tools.send("files/MvFile",{sfile:e.sfile,dfile:e.dfile,rename:e.rename||!0},function(e){t&&t(e)},"Renaming")},shear_file_req:function(e,t){this.rename_file_req({sfile:e.sfile,dfile:e.dfile,rename:!1},function(e){t&&t(e)},"Cutting")},check_exists_files_req:function(e,t){var i=bt.load("Checking files, please wait...");bt.send("CheckExistsFiles","files/CheckExistsFiles",{dfile:e.dfile,filename:e.filename},function(e){i.close(),t&&t(e)})},copy_file_req:function(e,t){bt.send("CopyFile","files/CopyFile",{sfile:e.sfile,dfile:e.dfile},function(e){t&&t(e)})},compress_file_req:function(e,t){bt.send("Zip","files/Zip",{sfile:e.sfile,dfile:e.dfile,z_type:e.z_type,path:e.path},function(e){t&&t(e)})},get_task_req:function(e,t){bt.send("get_task_lists","task/get_task_lists",{status:e.status},function(e){t&&t(e)})},get_file_access:function(){bt.send("GetFileAccess","files/GetFileAccess",{filename:data.filename},function(e){callback&&callback(e)})},set_file_access:function(){bt.send("SetFileAccess","files/SetFileAccess",{filename:data.filename,user:data.user,access:data.access,all:data.all},function(e){callback&&callback(e)})},del_file_req:function(e,t){var i="dir"===e.type?"DeleteDir":"DeleteFile",a=bt.load("Deleting file, please wait...");bt.send(i,"files/"+i,{path:e.path},function(e){a.close(),layer.msg(e.msg,{icon:e.status?1:2}),t&&t(e)})},down_file_req:function(e,t){window.open("/download?filename="+encodeURIComponent(e.path))},get_file_size:function(e,t){bt_tools.send("files/get_path_size",{path:e.path},t,"Getting directory size, please wait...")},get_dir_size:function(e,t){bt_tools.send("files/GetDirSize",{path:e.path},function(e){$("#file_all_size").text(e),t&&t(e)},{tips:"Counting, please wait...",verify:!0})},get_dir_list:function(e,t){var i=this,a=bt.get_cookie("files_sort");a&&(e.sort=a,e.reverse=bt.get_cookie("name_reverse")),bt_tools.send("files/GetDir",$.extend({p:1,showRow:bt.get_storage("local","showRow")||i.file_page_num,path:bt.get_cookie("Path")||e.path},e),t,{tips:!1})},compress_file_or_dir:function(e,t){var i=this;$(".selection_right_menu").removeAttr("style"),this.reader_form_line({url:"Zip",overall:{width:"310px"},data:[{label:"Compress type",type:"select",name:"z_type",value:e.open,list:[["tar_gz","tar.gz"],["zip","zip"],["rar","rar"]]},{label:"Compress path",id:"compress_path",name:"dfile",placeholder:"URL address",value:e.path+"."+("tar_gz"==e.open?"tar.gz":e.open)}],beforeSend:function(t){var i=e.path.lastIndexOf("/"),a=e.path.substring(0,i+1);return{sfile:e.filename,dfile:t.dfile,z_type:"tar_gz"==t.z_type?"tar.gz":t.z_type,path:a}}},function(a,l){var s=layer.open({type:1,title:"Compress "+e.type_tips+"[ "+e.filename+" ]",area:"520px",shadeClose:!1,closeBtn:2,skin:"compress_file_view",btn:["Compress","Close"],content:l[0].outerHTML,success:function(){$("select[name=z_type]").change(function(){var i=$(this).val(),a=$("input[name=dfile]").val(),l=[];a=a.substring(0,a.lastIndexOf("/")),l=a.split("/"),$("input[name=dfile]").val(a+"/"+(t?l[l.length-1]:e.filename)+"."+i)}),$(".compress_file_view .line:nth-child(2)").find(".info-r").append('<span class="glyphicon glyphicon-folder-open cursor" style="margin-left: 10px;" onclick="ChangePath(\'compress_path\')"></span>')},yes:function(){var e=a.getVal();if(""==e.dfile)return layer.msg("Please select a valid address",{icon:2});a.submitForm(function(e,t){setTimeout(function(){i.reader_file_list({path:t.path})},1e3),null!=e&&null!=e||layer.msg(lan.files.zip_ok,{icon:1}),e.status&&i.render_present_task_list(),layer.close(s)})}})})},unpack_file_to_path:function(e){var t=this,i="zip",a="";a=e.path.substring(0,e.path.lastIndexOf("/")),this.reader_form_line({url:"UnZip",overall:{width:"310px"},data:[{label:"File name",name:"z_name",placeholder:"Compress file name",value:e.path},{label:"Compress path",name:"z_path",placeholder:"Compress path",value:a},{label:"Encoding",name:"z_code",type:"select",value:"UTF-8",list:[["UTF-8","UTF-8"],["gb18030","GBK"]]}],beforeSend:function(e){return{sfile:e.z_name,dfile:e.z_path,type:i,coding:e.z_code,password:e.z_password}}},function(a,l){var s=layer.open({type:1,title:"Decompress file",area:"520px",shadeClose:!1,closeBtn:2,skin:"unpack_file_view",btn:["Comfirm","Cancel"],content:l[0].outerHTML,success:function(){"gz"==e.ext&&(i="tar"),"zip"==i&&$(".unpack_file_view .line:nth-child(2)").append('<div class="line"><span class="tname">Password</span><div class="info-r"><input type="text" name="z_password" class="bt-input-text " placeholder="No password let it empty" style="width:310px" value=""></div></div>')},yes:function(){var e=a.getVal();return""==e.z_name?layer.msg("Please enter the file name path",{icon:2}):""==e.z_path?layer.msg("Please enter the decompression address",{icon:2}):void a.submitForm(function(e,i){layer.close(s),setTimeout(function(){t.reader_file_list({path:i.path})},1e3),e.status&&t.render_present_task_list(),layer.msg(e.msg,{icon:e.status?1:2})})}})})},match_unqualified_string:function(e){var t=RegExp(/[(\ )(\*)(\|)(\\)(\:)(\")(\/)(\<)(\>)(\?)(\)]+/);return t.test(e)},reader_form_line:function(e,t){var i=this,a=bt.get_random(10),l=$('<form id="'+a+'" class="bt-form pd20"></form>'),s=e,n=[];i=this;Array.isArray(e)||(s=e.data),$.each(s,function(t,i){var a=i.labelWidth||e.overall.labelWidth||null,s=bt.get_random(10),o=i.labelWidth||e.overall.width||null,r=$('<div class="line"><span class="tname" '+(a?"width:"+a:"")+">"+(i.label||"")+'</span><div class="info-r"></div></div>'),c=$(function(){switch(i.type){case"select":return"<select "+(i.disabled?"disabled":"")+" "+(i.readonly?"readonly":"")+' class="bt-input-text mr5 '+(i.readonly?"readonly-form-input":"")+'" name="'+i.name+'" '+(i.eventType?'data-event="'+s+'"':"")+' style="'+(o?"width:"+o:"")+'">'+function(e){var t="";return $.each(e.list,function(i,a){Array.isArray(a)?t+='<option value="'+a[0]+'" '+(e.value===a[0]?"selected":"")+">"+a[1]+"</option>":t+='<option value="'+a+'" '+(e.value===i?"selected":"")+">"+a+"</option>"}),t}(i)+"</select>";case"text":default:return"<input "+(i.disabled?"disabled":"")+" "+(i.readonly?"readonly":"")+" "+(i.eventType?'data-event="'+s+'"':"")+' type="text" name="'+i.name+'" '+(i.id?'id="'+i.id+'"':"")+' class="bt-input-text '+(i.readonly?"readonly-form-input":"")+'" placeholder="'+(i.placeholder||"")+'" style="'+(o?"width:"+o:"")+'" value="'+(i.value||"")+'"/>'}}());(i.eventType||i.event)&&(Array.isArray(i.eventType)||(i.eventType=[i.eventType]),$.each(i.eventType,function(t,a){if(n.push({el:s,type:a||"click",event:i[a]||null}),e.el){var l=$('[data-event="'+i.el+'"]');if(i[a])"enter"==a?l.on("keyup",function(e){13==e.keyCode&&i.event(e)}):l.on(i||"click",i.event);else if("focus"==a){var o=l.val();""!=o&&l.val("").focus().val(o)}else l[a]()}})),r.find(".info-r").append(c),l.append(r)}),e.el&&$(e.el).empty().append(l),t&&t({getVal:function(){return $("#"+a).serializeObject()},setEvent:function(){$.each(n,function(e,t){var i=$('[data-event="'+t.el+'"]');if(null===t.event)if("focus"==t.type){var a=i.val();""!=a&&i.val("").focus().val(a)}else i[t.type]();else"enter"==t.type?i.on("keyup",function(e){13==e.keyCode&&t.event(e)}):i.on(t.type,t.event)})},submitForm:function(t){var a=this.getVal();e.beforeSend&&(a=e.beforeSend(a)),i.loadT=bt.load("submitting the form, please wait..."),bt.send(e.url,"files/"+e.url,a,function(e){i.loadT.close(),t&&t(e,a)})}},l)},$http:function(e,t,i){var a=this,l="";"string"==typeof e?("object"!=typeof t&&(i=t,t={}),Array.isArray(a.method_list[e])||(a.method_list[e]=["files",a.method_list[e]]),a.$http({method:e,tips:!!a.method_list[e][1]&&a.method_list[e][1],module:a.method_list[e][0],data:t,msg:!0},i)):(void 0!==e.tips&&e.tips&&(l=bt.load(e.tips)),bt.send(e.method,(e.module||"files")+"/"+e.method,e.data||{},function(e){if(""!=l&&l.close(),"string"==typeof e&&(e=JSON.parse(e)),!1===e.status&&e.msg)return bt.msg(e),!1;t&&t(e)}))}};bt_file.init(),Function.prototype.delay=function(e,t,i){return Array.isArray(t)||(i=t,t=[]),void 0===i&&(i=0),setTimeout(this.apply(e,t),i),this},jQuery.prototype.serializeObject=function(){var e,t,i,a,l;for(e=this.serializeArray(),t={},i=t.hasOwnProperty,a=0;a<e.length;a++)l=e[a],i.call(t,l.name)||(t[l.name]=l.value);return t};